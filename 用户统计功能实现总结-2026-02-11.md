# ç”¨æˆ·ç»Ÿè®¡åŠŸèƒ½å®ç°æ€»ç»“

**ä»»åŠ¡æ—¥æœŸ**: 2026-02-11
**ä»»åŠ¡æè¿°**: åœ¨å‰ç«¯æ˜¾ç¤ºç™»å½•ç”¨æˆ·æ•°é‡+æµ‹è¯•ç”¨æˆ·æ•°é‡

---

## ä»»åŠ¡åˆ†è§£

### 1. éœ€æ±‚åˆ†æ âœ…
- æ˜¾ç¤ºç™»å½•ç”¨æˆ·æ•°é‡ï¼ˆçœŸå®ç”¨æˆ·ï¼‰
- æ˜¾ç¤ºæµ‹è¯•ç”¨æˆ·æ•°é‡
- ä½ç½®ï¼šå‰ç«¯é¡¶éƒ¨å¯¼èˆªæ 
- æ•°æ®æ¥æºï¼šSupabase æ•°æ®åº“

### 2. æ•°æ®åº“è®¾è®¡ âœ…
åˆ›å»ºæ–°çš„æ•°æ®åº“è¡¨å’Œè§†å›¾ï¼š
- `public.users` - ç”¨æˆ·è¡¨
- `public.user_statistics` - ç”¨æˆ·ç»Ÿè®¡è§†å›¾

### 3. å‰ç«¯å®ç° âœ…
- HTMLï¼šæ·»åŠ ç”¨æˆ·ç»Ÿè®¡æ˜¾ç¤ºç»„ä»¶
- CSSï¼šæ·»åŠ ç”¨æˆ·ç»Ÿè®¡æ ·å¼
- JavaScriptï¼šå®ç°æ•°æ®è·å–å’Œæ›´æ–°é€»è¾‘
- é™çº§å¤„ç†ï¼šæœªé…ç½® Supabase æ—¶ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®

### 4. é…ç½®æ›´æ–° âœ…
- æ›´æ–° `.env.example` æ·»åŠ  Supabase é…ç½®
- æ›´æ–°æ•°æ®åº“åˆ›å»ºè„šæœ¬
- æ›´æ–°æ–‡æ¡£è¯´æ˜

---

## å®ç°è¯¦æƒ…

### æ•°æ®åº“ä¿®æ”¹

#### 1. æ–°å¢ `users` è¡¨

```sql
CREATE TABLE public.users (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  wallet_address TEXT NOT NULL UNIQUE,
  is_test_user BOOLEAN DEFAULT FALSE,
  first_login_at TIMESTAMPTZ,
  last_login_at TIMESTAMPTZ,
  login_count INTEGER DEFAULT 0,
  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  CONSTRAINT chk_user_wallet_address_format CHECK (wallet_address ~ '^0x[a-fA-F0-9]{40}$')
);
```

**å­—æ®µè¯´æ˜**:
- `wallet_address`: ç”¨æˆ·é’±åŒ…åœ°å€ï¼ˆå”¯ä¸€ï¼‰
- `is_test_user`: æ˜¯å¦ä¸ºæµ‹è¯•ç”¨æˆ·
- `first_login_at`: é¦–æ¬¡ç™»å½•æ—¶é—´
- `last_login_at`: æœ€åç™»å½•æ—¶é—´
- `login_count`: ç™»å½•æ¬¡æ•°

#### 2. æ–°å¢ `user_statistics` è§†å›¾

```sql
CREATE VIEW public.user_statistics AS
SELECT
  COUNT(*) as total_users,
  COUNT(CASE WHEN is_test_user = TRUE THEN 1 END) as test_users,
  COUNT(CASE WHEN is_test_user = FALSE THEN 1 END) as real_users,
  COUNT(CASE WHEN last_login_at >= NOW() - INTERVAL '24 hours' THEN 1 END) as active_users_24h,
  COUNT(CASE WHEN last_login_at >= NOW() - INTERVAL '7 days' THEN 1 END) as active_users_7d,
  COUNT(CASE WHEN last_login_at >= NOW() - INTERVAL '30 days' THEN 1 END) as active_users_30d,
  SUM(login_count) as total_logins,
  AVG(login_count) as avg_logins_per_user,
  MAX(last_login_at) as latest_login
FROM public.users;
```

**ç»Ÿè®¡æŒ‡æ ‡**:
- `total_users`: æ€»ç”¨æˆ·æ•°
- `test_users`: æµ‹è¯•ç”¨æˆ·æ•°
- `real_users`: çœŸå®ç”¨æˆ·æ•°
- `active_users_24h`: 24 å°æ—¶å†…æ´»è·ƒç”¨æˆ·
- `active_users_7d`: 7 å¤©å†…æ´»è·ƒç”¨æˆ·
- `active_users_30d`: 30 å¤©å†…æ´»è·ƒç”¨æˆ·
- `total_logins`: æ€»ç™»å½•æ¬¡æ•°
- `avg_logins_per_user`: å¹³å‡ç™»å½•æ¬¡æ•°
- `latest_login`: æœ€è¿‘ç™»å½•æ—¶é—´

#### 3. æµ‹è¯•æ•°æ®

æ’å…¥æµ‹è¯•ç”¨æˆ·ï¼š
- 4 ä¸ªæµ‹è¯•ç”¨æˆ·ï¼ˆ`is_test_user = TRUE`ï¼‰
- 5 ä¸ªçœŸå®ç”¨æˆ·ï¼ˆ`is_test_user = FALSE`ï¼‰

---

### å‰ç«¯å®ç°

#### 1. HTML ä¿®æ”¹

åœ¨é¡¶éƒ¨å¯¼èˆªæ æ·»åŠ ç”¨æˆ·ç»Ÿè®¡ç»„ä»¶ï¼š

```html
<div class="user-stats" id="userStats">
  <span class="user-stat-item">
    <span class="stat-icon">ğŸ‘¥</span>
    <span class="stat-label">ç™»å½•ç”¨æˆ·:</span>
    <span class="stat-value" id="realUserCount">--</span>
  </span>
  <span class="user-stat-item">
    <span class="stat-icon">ğŸ§ª</span>
    <span class="stat-label">æµ‹è¯•ç”¨æˆ·:</span>
    <span class="stat-value" id="testUserCount">--</span>
  </span>
</div>
```

#### 2. CSS æ ·å¼

```css
/* ç”¨æˆ·ç»Ÿè®¡ */
.user-stats {
  display: flex;
  align-items: center;
  gap: var(--spacing-lg);
  padding: var(--spacing-sm) var(--spacing-md);
  background-color: var(--color-gray-100);
  border-radius: var(--radius-md);
}

.user-stat-item {
  display: flex;
  align-items: center;
  gap: var(--spacing-xs);
}

.stat-icon {
  font-size: var(--font-size-lg);
}

.stat-label {
  color: var(--color-gray-600);
  font-size: var(--font-size-sm);
}

.stat-value {
  color: var(--color-primary);
  font-weight: var(--font-weight-bold);
  font-size: var(--font-size-base);
}
```

#### 3. JavaScript å®ç°

**æ ¸å¿ƒå‡½æ•°**:

```javascript
/**
 * æ›´æ–°ç”¨æˆ·ç»Ÿè®¡
 */
async function updateUserStatistics() {
  try {
    // è·å– Supabase é…ç½®
    const supabaseUrl = import.meta.env.VITE_SUPABASE_URL
    const supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY

    if (!supabaseUrl || !supabaseAnonKey) {
      console.log('æœªé…ç½® Supabaseï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®')
      updateMockUserStatistics()
      return
    }

    // ä» Supabase è·å–ç”¨æˆ·ç»Ÿè®¡
    const response = await fetch(`${supabaseUrl}/rest/v1/user_statistics`, {
      headers: {
        'apikey': supabaseAnonKey,
        'Authorization': `Bearer ${supabaseAnonKey}`
      }
    })

    if (!response.ok) {
      throw new Error('è·å–ç”¨æˆ·ç»Ÿè®¡å¤±è´¥')
    }

    const stats = await response.json()
    if (stats && stats.length > 0) {
      const stat = stats[0]
      document.getElementById('realUserCount').textContent = stat.real_users || 0
      document.getElementById('testUserCount').textContent = stat.test_users || 0
    } else {
      updateMockUserStatistics()
    }

  } catch (error) {
    console.error('è·å–ç”¨æˆ·ç»Ÿè®¡å¤±è´¥:', error)
    // é™çº§åˆ°æ¨¡æ‹Ÿæ•°æ®
    updateMockUserStatistics()
  }
}

/**
 * æ›´æ–°æ¨¡æ‹Ÿç”¨æˆ·ç»Ÿè®¡ï¼ˆå½“ Supabase æœªé…ç½®æ—¶ä½¿ç”¨ï¼‰
 */
function updateMockUserStatistics() {
  const mockRealUsers = 8 + Math.floor(Math.random() * 5)
  const mockTestUsers = 4

  document.getElementById('realUserCount').textContent = mockRealUsers
  document.getElementById('testUserCount').textContent = mockTestUsers
}
```

**é›†æˆç‚¹**:
- åœ¨ `loadData()` å‡½æ•°ä¸­è°ƒç”¨ `updateUserStatistics()`
- æ¯ 30 ç§’è‡ªåŠ¨åˆ·æ–°

#### 4. é™çº§æœºåˆ¶

- **Supabase æœªé…ç½®**: ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®
- **API è¯·æ±‚å¤±è´¥**: é™çº§åˆ°æ¨¡æ‹Ÿæ•°æ®
- **æ— æ•°æ®è¿”å›**: ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®

æ¨¡æ‹Ÿæ•°æ®è¡Œä¸ºï¼š
- çœŸå®ç”¨æˆ·æ•°ï¼š8-13 ä¹‹é—´éšæœºå˜åŒ–
- æµ‹è¯•ç”¨æˆ·æ•°ï¼šå›ºå®š 4 ä¸ª

---

### ç¯å¢ƒå˜é‡é…ç½®

åœ¨ `.env.example` ä¸­æ·»åŠ ï¼š

```bash
# ========================================
# Supabase é…ç½®ï¼ˆç”¨äºç”¨æˆ·ç»Ÿè®¡ï¼‰
# ========================================
# Supabase é¡¹ç›® URLï¼ˆå¯é€‰ï¼Œå¦‚æœä¸é…ç½®åˆ™ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®ï¼‰
VITE_SUPABASE_URL=

# Supabase Anon Keyï¼ˆå¯é€‰ï¼Œå¦‚æœä¸é…ç½®åˆ™ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®ï¼‰
VITE_SUPABASE_ANON_KEY=
```

---

## ä¿®æ”¹æ–‡ä»¶æ¸…å•

### æ•°æ®åº“ç›¸å…³
1. `supabase/frontend/create-frontend-database.sql` - æ·»åŠ  users è¡¨å’Œç»Ÿè®¡è§†å›¾

### å‰ç«¯ç›¸å…³
2. `frontend/DemoSite/index.html` - æ·»åŠ ç”¨æˆ·ç»Ÿè®¡ç»„ä»¶
3. `frontend/DemoSite/css/styles.css` - æ·»åŠ ç”¨æˆ·ç»Ÿè®¡æ ·å¼
4. `frontend/DemoSite/js/app.js` - å®ç°ç”¨æˆ·ç»Ÿè®¡é€»è¾‘
5. `frontend/DemoSite/.env.example` - æ·»åŠ  Supabase é…ç½®

### æ–‡æ¡£ç›¸å…³
6. `frontend/DemoSite/README.md` - æ›´æ–°åŠŸèƒ½è¯´æ˜

---

## ä½¿ç”¨è¯´æ˜

### å¼€å‘ç¯å¢ƒ

1. **ä¸é…ç½® Supabase**ï¼ˆé»˜è®¤ï¼‰
   - ç›´æ¥æ‰“å¼€å‰ç«¯é¡µé¢
   - ç”¨æˆ·ç»Ÿè®¡æ˜¾ç¤ºæ¨¡æ‹Ÿæ•°æ®
   - çœŸå®ç”¨æˆ·æ•°ä¼šåœ¨ 8-13 ä¹‹é—´éšæœºå˜åŒ–

2. **é…ç½® Supabase**
   - åˆ›å»º `.env.local` æ–‡ä»¶
   - å¡«å†™ Supabase URL å’Œ Anon Key
   - ç”¨æˆ·ç»Ÿè®¡æ˜¾ç¤ºçœŸå®æ•°æ®

### ç”Ÿäº§ç¯å¢ƒ

1. åœ¨ Supabase ä¸­åˆ›å»ºå‰ç«¯æ•°æ®åº“
2. æ‰§è¡Œ `supabase/frontend/create-frontend-database.sql`
3. åœ¨ç¯å¢ƒå˜é‡ä¸­é…ç½® Supabase å‡­è¯
4. éƒ¨ç½²å‰ç«¯

---

## åŠŸèƒ½ç‰¹æ€§

### ä¼˜ç‚¹
1. **é™çº§å¤„ç†**: æœªé…ç½®æ•°æ®åº“æ—¶ä¹Ÿèƒ½æ­£å¸¸æ˜¾ç¤º
2. **å®æ—¶æ›´æ–°**: æ¯ 30 ç§’è‡ªåŠ¨åˆ·æ–°
3. **æ¸…æ™°å±•ç¤º**: ä½¿ç”¨å›¾æ ‡å’Œé¢œè‰²åŒºåˆ†ä¸åŒç±»å‹ç”¨æˆ·
4. **æ•°æ®éªŒè¯**: é’±åŒ…åœ°å€æ ¼å¼éªŒè¯

### é™åˆ¶
1. **ä»…æ˜¾ç¤º**: ä¸æä¾›ç”¨æˆ·ç®¡ç†åŠŸèƒ½
2. **ç»Ÿè®¡ç»´åº¦**: ä»…æ˜¾ç¤ºç™»å½•ç”¨æˆ·å’Œæµ‹è¯•ç”¨æˆ·æ•°é‡
3. **å†å²æ•°æ®**: ä¸æ˜¾ç¤ºå†å²è¶‹åŠ¿

---

## åç»­ä¼˜åŒ–å»ºè®®

### çŸ­æœŸ
1. **æ·»åŠ æ›´å¤šç»Ÿè®¡æŒ‡æ ‡**:
   - 24 å°æ—¶æ´»è·ƒç”¨æˆ·
   - 7 å¤©æ´»è·ƒç”¨æˆ·
   - 30 å¤©æ´»è·ƒç”¨æˆ·

2. **æ·»åŠ ç”¨æˆ·åˆ—è¡¨é¡µé¢**:
   - æ˜¾ç¤ºæ‰€æœ‰ç”¨æˆ·
   - æ”¯æŒæœç´¢å’Œè¿‡æ»¤
   - æ˜¾ç¤ºç™»å½•å†å²

### ä¸­æœŸ
1. **æ·»åŠ è¶‹åŠ¿å›¾è¡¨**:
   - ç”¨æˆ·å¢é•¿è¶‹åŠ¿
   - æ´»è·ƒç”¨æˆ·è¶‹åŠ¿

2. **æ·»åŠ ç”¨æˆ·è¯¦æƒ…**:
   - æŸ¥çœ‹ç”¨æˆ·å†å²
   - ç¼–è¾‘æµ‹è¯•ç”¨æˆ·æ ‡è®°

### é•¿æœŸ
1. **å®æ—¶åœ¨çº¿ç»Ÿè®¡**:
   - WebSocket å®æ—¶æ›´æ–°
   - åœ¨çº¿ç”¨æˆ·åˆ—è¡¨

2. **ç”¨æˆ·è¡Œä¸ºåˆ†æ**:
   - è®¿é—®ç»Ÿè®¡
   - åŠŸèƒ½ä½¿ç”¨ç»Ÿè®¡

---

## æµ‹è¯•æ£€æŸ¥æ¸…å•

- [ ] æœªé…ç½® Supabase æ—¶æ˜¾ç¤ºæ¨¡æ‹Ÿæ•°æ®
- [ ] é…ç½® Supabase åæ˜¾ç¤ºçœŸå®æ•°æ®
- [ ] ç”¨æˆ·ç»Ÿè®¡æ¯ 30 ç§’è‡ªåŠ¨åˆ·æ–°
- [ ] ç‚¹å‡»åˆ·æ–°æŒ‰é’®æ‰‹åŠ¨æ›´æ–°ç»Ÿè®¡
- [ ] Supabase è¿æ¥å¤±è´¥æ—¶é™çº§åˆ°æ¨¡æ‹Ÿæ•°æ®
- [ ] æ ·å¼åœ¨ä¸åŒå±å¹•å°ºå¯¸ä¸‹æ­£å¸¸æ˜¾ç¤º
- [ ] å›¾æ ‡å’Œæ–‡å­—å¯¹é½æ­£ç¡®

---

## ç›¸å…³æ–‡æ¡£

- [Supabase æ•°æ®åº“å®¡è®¡æŠ¥å‘Š](../docs/å¼€å‘æŒ‡å—/Supabaseæ•°æ®åº“ä»£ç å®¡è®¡æŠ¥å‘Š.md)
- [Supabase æ•°æ®åº“ä¿®å¤æ€»ç»“](../supabase/æ•°æ®åº“ä¿®å¤æ€»ç»“-2026-02-11.md)
- [å‰ç«¯æ•°æ®åº“è®¾è®¡æ–‡æ¡£](../supabase/frontend/Frontend-æ•°æ®åº“è®¾è®¡æ–‡æ¡£.md)

---

**å®ç°å®Œæˆæ—¶é—´**: 2026-02-11
**å®ç°äººå‘˜**: AI Assistant
**ç‰ˆæœ¬**: v2.5.0
