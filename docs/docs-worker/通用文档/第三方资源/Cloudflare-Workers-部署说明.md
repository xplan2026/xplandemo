# Cloudflare Workers éƒ¨ç½²è¯´æ˜

æœ¬æ–‡æ¡£è¯´æ˜ X-plan é¡¹ç›®ä¸­ Cloudflare Workers çš„éƒ¨ç½²æ–¹å¼å’Œç­–ç•¥ã€‚

## ğŸ“‹ éƒ¨ç½²æ¶æ„

### å½“å‰æ¶æ„è¯´æ˜

X-plan é‡‡ç”¨ **ç»Ÿä¸€æ‰©å±•æ¨¡å— + ç‹¬ç«‹ Worker** çš„æ¶æ„ï¼š

```
cloudflare/
â”œâ”€â”€ extensions/              # å…±äº«æ‰©å±•æ¨¡å—
â”‚   â”œâ”€â”€ scanner/            # æ‰«æå™¨æ‰©å±•
â”‚   â”œâ”€â”€ transfer/           # è½¬è´¦ç®¡ç†å™¨æ‰©å±•
â”‚   â”œâ”€â”€ auth/               # è®¤è¯ç®¡ç†å™¨æ‰©å±•
â”‚   â””â”€â”€ database/          # æ•°æ®åº“æ‰©å±•
â”œâ”€â”€ worker-1-interception/  # Worker-1: æŠ¢å…ˆè½¬ç§»
â”‚   â”œâ”€â”€ src/index.js        # ç‹¬ç«‹å…¥å£
â”‚   â”œâ”€â”€ wrangler.toml       # ç‹¬ç«‹é…ç½®
â”‚   â””â”€â”€ package.json
â”œâ”€â”€ worker-2-scheduler/     # Worker-2: å®šæ—¶ä»»åŠ¡
â”‚   â”œâ”€â”€ src/index.js        # ç‹¬ç«‹å…¥å£
â”‚   â”œâ”€â”€ wrangler.toml       # ç‹¬ç«‹é…ç½®
â”‚   â””â”€â”€ package.json
â””â”€â”€ worker-3-surveillance/  # Worker-3: ç›‘æ§å‘Šè­¦ï¼ˆå¾…å¼€å‘ï¼‰
    â”œâ”€â”€ src/index.js        # ç‹¬ç«‹å…¥å£
    â”œâ”€â”€ wrangler.toml       # ç‹¬ç«‹é…ç½®
    â””â”€â”€ package.json
```

## ğŸš€ éƒ¨ç½²ç­–ç•¥

### æ ¸å¿ƒåŸåˆ™

**æ¯ä¸ª Worker å¯ä»¥å•ç‹¬éƒ¨ç½²ï¼Œä¸éœ€è¦åŒæ—¶éƒ¨ç½²ã€‚**

### ç‹¬ç«‹éƒ¨ç½²ç‰¹æ€§

æ¯ä¸ª Worker éƒ½æ˜¯ **å®Œå…¨ç‹¬ç«‹** çš„ Cloudflare Worker åº”ç”¨ï¼š

| ç‰¹æ€§ | è¯´æ˜ |
|------|------|
| **ç‹¬ç«‹é…ç½®** | æ¯ä¸ª Worker æœ‰è‡ªå·±çš„ `wrangler.toml` |
| **ç‹¬ç«‹è·¯ç”±** | æ¯ä¸ª Worker æœ‰ç‹¬ç«‹çš„åŸŸå/è·¯ç”± |
| **ç‹¬ç«‹å®šæ—¶ä»»åŠ¡** | æ¯ä¸ª Worker æœ‰ç‹¬ç«‹çš„ Cron Triggers |
| **ç‹¬ç«‹è¿è¡Œ** | éƒ¨ç½²åäº’ä¸å½±å“ |
| **ä»£ç æ‰“åŒ…** | æ‰©å±•æ¨¡å—åœ¨éƒ¨ç½²æ—¶æ‰“åŒ…è¿› Worker |

### æ‰©å±•æ¨¡å—å…±äº«æ–¹å¼

æ‰©å±•æ¨¡å—é€šè¿‡ **ES6 æ¨¡å—å¯¼å…¥** å®ç°å…±äº«ï¼š

```javascript
// Worker-1 å¼•ç”¨æ‰©å±•
import { InterceptionScanner } from '../../extensions/scanner/Scanner.js'
import { TransferManager } from '../../extensions/transfer/Transfer.js'

// Worker-2 å¼•ç”¨æ‰©å±•
import { SchedulerScanner } from '../../extensions/scanner/Scanner.js'
import { TransferManager } from '../../extensions/transfer/Transfer.js'
```

**å·¥ä½œåŸç†**ï¼š
- éƒ¨ç½² Worker-1 æ—¶ï¼ŒWrangler å°† `InterceptionScanner` ç›¸å…³ä»£ç æ‰“åŒ…è¿› Worker-1
- éƒ¨ç½² Worker-2 æ—¶ï¼ŒWrangler å°† `SchedulerScanner` ç›¸å…³ä»£ç æ‰“åŒ…è¿› Worker-2
- ä¸¤è€…åœ¨è¿è¡Œæ—¶**å®Œå…¨ç‹¬ç«‹**ï¼Œäº’ä¸ä¾èµ–

## ğŸ“¦ éƒ¨ç½²æ–¹å¼

### æ–¹å¼ 1ï¼šå•ç‹¬éƒ¨ç½²ï¼ˆæ¨èï¼‰

é€‚ç”¨äºï¼šå¼€å‘ã€æµ‹è¯•ã€æ¸è¿›å¼ç”Ÿäº§éƒ¨ç½²

```bash
# éƒ¨ç½² Worker-1
cd cloudflare/worker-1-interception
wrangler deploy

# æˆ–ä½¿ç”¨ç»Ÿä¸€å‘½ä»¤
npm run deploy:w1
```

**ä¼˜åŠ¿**ï¼š
- âœ… çµæ´»æ€§é«˜ï¼Œå¯ä»¥åªéƒ¨ç½²éœ€è¦çš„ Worker
- âœ… éƒ¨ç½²å¤±è´¥ä¸å½±å“å…¶ä»– Worker
- âœ… ä¾¿äºåˆ†é˜¶æ®µå‘å¸ƒ

**âš ï¸ é‡è¦ï¼šwrangler 4.x éƒ¨ç½²æ³¨æ„äº‹é¡¹**

ä½¿ç”¨ wrangler 4.x æ—¶ï¼Œå¿…é¡»åœ¨ Worker å­ç›®å½•å†…è¿è¡Œ `wrangler deploy`ï¼š

```bash
# âœ… æ­£ç¡®ï¼ˆwrangler 4.xï¼‰
cd cloudflare/worker-turns-1
wrangler deploy

# âŒ é”™è¯¯ï¼ˆwrangler 4.x ä¸æ”¯æŒä»çˆ¶ç›®å½•æŒ‡å®š Worker åç§°ï¼‰
cd cloudflare
wrangler deploy worker-turns-1  # ä¼šå¤±è´¥ï¼šentry-point file not found
```

**åŸå› **ï¼šwrangler 4.x æ”¹å˜äº†å‘½ä»¤è¡Œå‚æ•°å¤„ç†æ–¹å¼ï¼Œæ— æ³•ä»çˆ¶ç›®å½•é€šè¿‡å‚æ•°æŒ‡å®š Worker ç›®å½•ï¼Œå¿…é¡»åœ¨ Worker å­ç›®å½•å†…æ‰§è¡Œéƒ¨ç½²å‘½ä»¤ã€‚

### æ–¹å¼ 2ï¼šé€ä¸ªéƒ¨ç½²

é€‚ç”¨äºï¼šç”Ÿäº§ç¯å¢ƒï¼ŒæŒ‰é¡ºåºéƒ¨ç½²éªŒè¯

```bash
# éƒ¨ç½² Worker-1
npm run deploy:w1

# ç¡®è®¤æ— è¯¯åï¼Œéƒ¨ç½² Worker-2
npm run deploy:w2

# æœ€åéƒ¨ç½² Worker-3
npm run deploy:w3
```

**ä¼˜åŠ¿**ï¼š
- âœ… æ¯ä¸ªéƒ¨ç½²åå¯ä»¥éªŒè¯
- âœ… å‡ºç°é—®é¢˜æ—¶å®¹æ˜“å®šä½
- âœ… æ”¯æŒå›æ»š

### æ–¹å¼ 3ï¼šåŒæ—¶éƒ¨ç½²ï¼ˆæ‰¹é‡ï¼‰

é€‚ç”¨äºï¼šæ›´æ–°æ‰©å±•æ¨¡å—åï¼Œéœ€è¦åŒæ—¶æ›´æ–°æ‰€æœ‰ Worker

```bash
# ä¸€æ¬¡æ€§éƒ¨ç½²æ‰€æœ‰ Worker
npm run deploy:all
```

**ä¼˜åŠ¿**ï¼š
- âœ… å¿«é€Ÿï¼Œä¸€æ¬¡æ€§å®Œæˆæ‰€æœ‰éƒ¨ç½²
- âœ… ç¡®ä¿æ‰€æœ‰ Worker ä½¿ç”¨ç›¸åŒç‰ˆæœ¬çš„æ‰©å±•æ¨¡å—

## âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹

### 1. æ‰©å±•æ¨¡å—ä¿®æ”¹åçš„å½±å“

ä¿®æ”¹æ‰©å±•æ¨¡å—åï¼Œéœ€è¦é‡æ–°éƒ¨ç½²æ‰€æœ‰å¼•ç”¨è¯¥æ‰©å±•çš„ Workerï¼š

```bash
# åœºæ™¯ï¼šä¿®æ”¹äº† Scanner.js

# éœ€è¦é‡æ–°éƒ¨ç½² Worker-1
npm run deploy:w1

# éœ€è¦é‡æ–°éƒ¨ç½² Worker-2
npm run deploy:w2
```

**åŸå› **ï¼šæ‰©å±•æ¨¡å—åœ¨éƒ¨ç½²æ—¶æ‰“åŒ…ï¼Œä¸æ˜¯è¿è¡Œæ—¶åŠ è½½ã€‚

### 2. ç¯å¢ƒå˜é‡é…ç½®

æ¯ä¸ª Worker çš„ç¯å¢ƒå˜é‡æ˜¯**ç‹¬ç«‹é…ç½®**çš„ï¼š

```bash
# Worker-1 ç¯å¢ƒå˜é‡
wrangler secret put SAFE_WALLET --name worker-1-interception
wrangler secret put WALLET_PRIVATE_KEY_0x... --name worker-1-interception

# Worker-2 ç¯å¢ƒå˜é‡
wrangler secret put SAFE_WALLET --name worker-2-scheduler
wrangler secret put WALLET_PRIVATE_KEY_0x... --name worker-2-scheduler
```

### 3. ç‹¬ç«‹è¿è¡Œ

éƒ¨ç½²åçš„ Worker åœ¨ Cloudflare ä¸Š**å®Œå…¨ç‹¬ç«‹è¿è¡Œ**ï¼š
- Worker-1 æœ‰ç‹¬ç«‹çš„å®šæ—¶ä»»åŠ¡ï¼ˆCron Triggersï¼‰
- Worker-2 æœ‰ç‹¬ç«‹çš„å®šæ—¶ä»»åŠ¡ï¼ˆCron Triggersï¼‰
- Worker-3 ä¹Ÿå¯ä»¥ç‹¬ç«‹è¿è¡Œ
- äº’ä¸å¹²æ‰°

## ğŸ’¡ éƒ¨ç½²æœ€ä½³å®è·µ

### å¼€å‘é˜¶æ®µ

```bash
# åªå¼€å‘å’Œéƒ¨ç½²æ­£åœ¨å·¥ä½œçš„ Worker
npm run dev:w1        # æœ¬åœ°è°ƒè¯•
npm run deploy:w1     # éƒ¨ç½² Worker-1
```

**ä¼˜åŠ¿**ï¼š
- å¿«é€Ÿè¿­ä»£ï¼Œä¸éœ€è¦éƒ¨ç½²æ‰€æœ‰ Worker
- å‡å°‘éƒ¨ç½²æ—¶é—´

### ç”Ÿäº§ç¯å¢ƒ

```bash
# æŒ‰éœ€è¦é€ä¸ªæ›´æ–°éƒ¨ç½²
npm run deploy:w1  # æ›´æ–° Worker-1
# éªŒè¯ Worker-1 æ­£å¸¸è¿è¡Œå
npm run deploy:w2  # æ›´æ–° Worker-2
# éªŒè¯ Worker-2 æ­£å¸¸è¿è¡Œå
npm run deploy:w3  # æ›´æ–° Worker-3
```

**ä¼˜åŠ¿**ï¼š
- é™ä½é£é™©ï¼Œå‡ºé—®é¢˜åªå½±å“ä¸€ä¸ª Worker
- ä¾¿äºå®šä½é—®é¢˜

### æ‰©å±•æ¨¡å—æ›´æ–°æ—¶

```bash
# ä¿®æ”¹äº†å…±äº«æ‰©å±•ï¼ˆå¦‚ Scanner.jsï¼‰
# ä¸€æ¬¡æ€§æ›´æ–°æ‰€æœ‰ Worker
npm run deploy:all
```

**ä¼˜åŠ¿**ï¼š
- ç¡®ä¿æ‰€æœ‰ Worker ä½¿ç”¨ç›¸åŒç‰ˆæœ¬çš„æ‰©å±•
- é¿å…ç‰ˆæœ¬ä¸ä¸€è‡´å¯¼è‡´çš„é—®é¢˜

## ğŸ“Š æ¶æ„å¯¹æ¯”

| ç‰¹æ€§ | å•ç‹¬éƒ¨ç½² | åŒæ—¶éƒ¨ç½² |
|------|---------|---------|
| Worker ç‹¬ç«‹æ€§ | âœ… æ˜¯ | âœ… æ˜¯ |
| ä»£ç æ‰“åŒ…æ–¹å¼ | âœ… æ¯ä¸ª Worker ç‹¬ç«‹æ‰“åŒ… | âœ… æ¯ä¸ª Worker ç‹¬ç«‹æ‰“åŒ… |
| éƒ¨ç½²çµæ´»æ€§ | âœ… é«˜ï¼ˆå¯é€‰éƒ¨ç½²å“ªä¸ªï¼‰ | âš ï¸ ä¸­ï¼ˆå…¨éƒ¨éƒ¨ç½²ï¼‰ |
| æ‰©å±•æ¨¡å—å…±äº« | âœ… éƒ¨ç½²æ—¶æ‰“åŒ… | âœ… éƒ¨ç½²æ—¶æ‰“åŒ… |
| è¿è¡Œæ—¶ä¾èµ– | âŒ æ—  | âŒ æ—  |
| Cloudflare è´¹ç”¨ | âœ… æŒ‰ä½¿ç”¨é‡è®¡ç®— | âœ… æŒ‰ä½¿ç”¨é‡è®¡ç®— |
| éƒ¨ç½²é€Ÿåº¦ | âš ï¸ è¾ƒæ…¢ï¼ˆé€ä¸ªéƒ¨ç½²ï¼‰ | âœ… å¿«ï¼ˆæ‰¹é‡éƒ¨ç½²ï¼‰ |
| é£é™©æ§åˆ¶ | âœ… é«˜ï¼ˆå¤±è´¥ä¸å½±å“å…¶ä»–ï¼‰ | âš ï¸ ä¸­ï¼ˆå¯èƒ½å…¨éƒ¨å¤±è´¥ï¼‰ |

## ğŸ”§ éƒ¨ç½²å‰æ£€æŸ¥æ¸…å•

### éƒ¨ç½²å•ä¸ª Worker

- [ ] ç¡®è®¤ `wrangler.toml` é…ç½®æ­£ç¡®
- [ ] ç¡®è®¤ç¯å¢ƒå˜é‡å·²é…ç½®
- [ ] ç¡®è®¤æ‰©å±•æ¨¡å—è·¯å¾„æ­£ç¡®
- [ ] æœ¬åœ°æµ‹è¯•é€šè¿‡
- [ ] éƒ¨ç½²åˆ° Cloudflare

### éƒ¨ç½²æ‰€æœ‰ Worker

- [ ] ç¡®è®¤æ‰€æœ‰ Worker çš„ `wrangler.toml` é…ç½®æ­£ç¡®
- [ ] ç¡®è®¤æ‰€æœ‰ç¯å¢ƒå˜é‡å·²é…ç½®
- [ ] ç¡®è®¤æ‰©å±•æ¨¡å—ç‰ˆæœ¬å…¼å®¹
- [ ] æœ¬åœ°æµ‹è¯•æ‰€æœ‰ Worker
- [ ] æ‰¹é‡éƒ¨ç½²åˆ° Cloudflare

## ğŸ“ éƒ¨ç½²é—®é¢˜æ’æŸ¥

### é—®é¢˜ 1ï¼šéƒ¨ç½²å¤±è´¥

**åŸå› **ï¼šæ‰©å±•æ¨¡å—è·¯å¾„é”™è¯¯

**è§£å†³**ï¼š
```javascript
// âŒ é”™è¯¯è·¯å¾„
import { Scanner } from './scanner.js'

// âœ… æ­£ç¡®è·¯å¾„
import { Scanner } from '../../extensions/scanner/Scanner.js'
```

### é—®é¢˜ 2ï¼šéƒ¨ç½²åè¿è¡Œæ—¶é”™è¯¯

**åŸå› **ï¼šæ‰©å±•æ¨¡å—åœ¨éƒ¨ç½²æ—¶æ‰“åŒ…ï¼Œè¿è¡Œæ—¶æ‰¾ä¸åˆ°

**è§£å†³**ï¼šé‡æ–°éƒ¨ç½²è¯¥ Worker

```bash
npm run deploy:w1
```

### é—®é¢˜ 3ï¼šç¯å¢ƒå˜é‡æœªç”Ÿæ•ˆ

**åŸå› **ï¼šæ¯ä¸ª Worker éœ€è¦å•ç‹¬é…ç½®ç¯å¢ƒå˜é‡

**è§£å†³**ï¼š
```bash
# é…ç½® Worker-1 çš„ç¯å¢ƒå˜é‡
wrangler secret put SAFE_WALLET --name worker-1-interception
```

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [Cloudflare Workers å®˜æ–¹æ–‡æ¡£](https://developers.cloudflare.com/workers/)
- [Wrangler éƒ¨ç½²æ–‡æ¡£](https://developers.cloudflare.com/workers/wrangler/)
- [é…ç½®æŒ‡å—.md](./é…ç½®æŒ‡å—.md)
- [éƒ¨ç½²æŒ‡å—.md](./éƒ¨ç½²æŒ‡å—.md)

---

**æ–‡æ¡£ç‰ˆæœ¬**: v2.0
**æœ€åæ›´æ–°**: 2026-01-16
