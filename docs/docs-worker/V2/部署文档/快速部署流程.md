# Guard Plus å¿«é€Ÿéƒ¨ç½²æµç¨‹

## éƒ¨ç½²æ¶æ„

```
å‰ç«¯ 1: ä½ çš„æœåŠ¡å™¨ (182.254.180.26) - å†…ç½‘æµ‹è¯•
å‰ç«¯ 2: Pinme - å¯¹å¤–å…¬å¼€
åç«¯: Cloudflare Worker
æ•°æ®åº“: æ–°çš„ Supabase æ•°æ®åº“
```

---

## ğŸ“‹ éƒ¨ç½²æµç¨‹

### ç¬¬ä¸€æ­¥ï¼šéƒ¨ç½² Cloudflare Worker

```bash
cd /workspace/guard-plus/guard-plus-worker

# 1. ç¼–è¾‘ wrangler.tomlï¼Œæ›¿æ¢ SUPABASE_URL å’Œ SUPABASE_KEY
nano wrangler.toml

# 2. è®¾ç½® secrets
npx wrangler secret put SAFE_WALLET
npx wrangler secret put WALLET_PRIVATE_KEY_0x886b739ba73c1ccaE826cb11c8d28e4750c68a89
npx wrangler secret put WALLET_PRIVATE_KEY_0x3d3914960567b3a253c429d5ab81da1f386f9111
npx wrangler secret put WALLET_PRIVATE_KEY_0x9f4fb2e9f0bb920efceE6ca21ebf1b6a2f8d8e16

# 3. éƒ¨ç½²
npm run deploy
```

### ç¬¬äºŒæ­¥ï¼šåˆå§‹åŒ–æœåŠ¡å™¨

SSH ç™»å½•æœåŠ¡å™¨åè¿è¡Œï¼š

```bash
# ä»æœ¬åœ°ä¸Šä¼ åˆå§‹åŒ–è„šæœ¬
scp /workspace/guard-plus/scripts/setup-server.sh root@182.254.180.26:/tmp/

# SSH ç™»å½•
ssh root@182.254.180.26

# è¿è¡Œåˆå§‹åŒ–è„šæœ¬
bash /tmp/setup-server.sh
```

### ç¬¬ä¸‰æ­¥ï¼šéƒ¨ç½²å‰ç«¯

```bash
cd /workspace/guard-plus/frontend

# 1. å®‰è£…ä¾èµ–
npm install

# 2. é…ç½®ç¯å¢ƒå˜é‡
echo "VITE_WORKER_URL=https://guard-plus.3813518962.workers.dev" > .env.production

# 3. æ„å»º
npm run build

# 4. éƒ¨ç½²åˆ°æœåŠ¡å™¨
bash /workspace/guard-plus/scripts/deploy-to-server.sh
```

### ç¬¬å››æ­¥ï¼šé…ç½® nginx

```bash
# ä¸Šä¼  nginx é…ç½®åˆ°æœåŠ¡å™¨
scp /workspace/guard-plus/nginx-config-example.conf root@182.254.180.26:/tmp/

# SSH ç™»å½•
ssh root@182.254.180.26

# å¤åˆ¶é…ç½®
cp /tmp/nginx-config-example.conf /etc/nginx/sites-available/guard-plus

# å¯ç”¨é…ç½®
ln -s /etc/nginx/sites-available/guard-plus /etc/nginx/sites-enabled/

# æµ‹è¯•é…ç½®
nginx -t

# é‡è½½ nginx
systemctl reload nginx
```

### ç¬¬äº”æ­¥ï¼šéªŒè¯éƒ¨ç½²

```bash
# éªŒè¯ Worker
bash /workspace/guard-plus/scripts/verify-deployment.sh

# è®¿é—®å‰ç«¯
# http://182.254.180.26
```

### ç¬¬å…­æ­¥ï¼šéƒ¨ç½²åˆ° Pinme

1. å°†å‰ç«¯éƒ¨ç½²åˆ° Pinme
2. è·å– Pinme åŸŸå
3. æ›´æ–° Worker çš„ `ALLOWED_DOMAINS`

---

## ğŸ“ é…ç½®è¯´æ˜

### Supabase æ•°æ®åº“è¡¨

```sql
-- æ‰«æä»»åŠ¡è¡¨
CREATE TABLE guard_tasks (
  id BIGSERIAL PRIMARY KEY,
  wallet_address VARCHAR(42) NOT NULL,
  vortex_start_time TIMESTAMP WITH TIME ZONE NOT NULL,
  scheduled_scan_time TIMESTAMP WITH TIME ZONE NOT NULL,
  status VARCHAR(20) NOT NULL DEFAULT 'pending',
  high_freq_until TIMESTAMP WITH TIME ZONE,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  completed_at TIMESTAMP WITH TIME ZONE,

  CONSTRAINT valid_wallet CHECK (wallet_address IN (
    '0x886b739Ba73C1ccaE826Cb11c8d28e4750C68A89',
    '0x3D3914960567b3A253C429d5Ab81DA1F386F9111',
    '0x9F4fb2E9F0bb920EFceE6ca21ebf1B6A2f8D8e16'
  ))
);

CREATE INDEX idx_guard_tasks_status ON guard_tasks(status);
CREATE INDEX idx_guard_tasks_wallet ON guard_tasks(wallet_address);
CREATE INDEX idx_guard_tasks_scheduled ON guard_tasks(scheduled_scan_time);

-- äº¤æ˜“è®°å½•è¡¨
CREATE TABLE IF NOT EXISTS transactions (
  id BIGSERIAL PRIMARY KEY,
  wallet_address VARCHAR(42),
  type VARCHAR(20),
  action VARCHAR(50),
  token_address VARCHAR(42),
  amount TEXT,
  status VARCHAR(20),
  tx_hash TEXT,
  triggered_by VARCHAR(100),
  trigger_reason TEXT,
  error_message TEXT,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- é”™è¯¯æ—¥å¿—è¡¨
CREATE TABLE IF NOT EXISTS error_logs (
  id BIGSERIAL PRIMARY KEY,
  error TEXT,
  context TEXT,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

### Worker ç¯å¢ƒå˜é‡

éœ€è¦é…ç½®ä»¥ä¸‹ä¿¡æ¯ï¼š

- `SUPABASE_URL`: æ–° Supabase é¡¹ç›®çš„ URL
- `SUPABASE_KEY`: æ–° Supabase é¡¹ç›®çš„ anon/public Key
- `SAFE_WALLET`: å®‰å…¨é’±åŒ…åœ°å€
- `WALLET_PRIVATE_KEY_0x886b...`: ç›‘æ§é’±åŒ…çš„ç§é’¥
- `ALLOWED_IPS`: "182.254.180.26"
- `ALLOWED_DOMAINS`: Pinme åŸŸåï¼ˆéƒ¨ç½²åˆ° Pinme åæ·»åŠ ï¼‰

---

## ğŸ”§ è„šæœ¬è¯´æ˜

| è„šæœ¬ | è¯´æ˜ |
|-----|------|
| `scripts/setup-server.sh` | æœåŠ¡å™¨ç¯å¢ƒåˆå§‹åŒ–ï¼ˆå®‰è£… nginxã€åˆ›å»ºç›®å½•ï¼‰ |
| `scripts/deploy-to-server.sh` | éƒ¨ç½²å‰ç«¯åˆ°æœåŠ¡å™¨ |
| `scripts/verify-deployment.sh` | éªŒè¯ Worker éƒ¨ç½²æ˜¯å¦æˆåŠŸ |
| `nginx-config-example.conf` | nginx é…ç½®æ¨¡æ¿ |

---

## âœ… éªŒè¯æ¸…å•

éƒ¨ç½²å®Œæˆåï¼Œæ£€æŸ¥ä»¥ä¸‹é¡¹ç›®ï¼š

- [ ] Worker å¥åº·æ£€æŸ¥é€šè¿‡
- [ ] å¯ä»¥æˆåŠŸåˆ›å»ºä»»åŠ¡
- [ ] å¯ä»¥æˆåŠŸæ‰«æä½™é¢
- [ ] æœåŠ¡å™¨å‰ç«¯å¯ä»¥è®¿é—®
- [ ] nginx é…ç½®æ­£å¸¸
- [ ] ï¼ˆå¯é€‰ï¼‰HTTPS é…ç½®å®Œæˆ
