# v2.4.1 前端开发规划

**版本**: v2.4.1  
**创建日期**: 2026-02-02  
**基于版本**: v2.4.0  
**状态**: 规划中

---

## 版本目标

为 Worker-Integrated-Pool 创建前端管理界面，提供可视化的 API 访问和资产管理功能。

---

## 核心功能

### 1. 钱包状态监控

**功能描述**：实时监控所有被保护钱包的余额和状态

**实现要点**：
- 调用 `GET /status` 接口获取钱包列表
- 显示每个钱包的 BNB、wkeyDAO、USDT 余额
- 显示钱包状态（正常/转账/应急）
- 支持自动刷新（手动或定时）
- 数据可视化（图表展示余额变化）

**UI 组件**：
- 钱包列表卡片
- 余额进度条
- 状态指示器（颜色编码）
- 刷新按钮

---

### 2. 单个钱包详情

**功能描述**：查看单个钱包的详细信息和历史记录

**实现要点**：
- 调用 `GET /wallet?address=0x...` 接口
- 显示钱包完整地址
- 显示余额详情
- 显示执行的动作和原因
- 显示交易历史（需要新增接口）

**UI 组件**：
- 钱包详情卡片
- 余额详情表格
- 动作说明区域
- 交易历史时间线

---

### 3. 应急状态监控

**功能描述**：查看所有钱包的应急状态

**实现要点**：
- 调用 `GET /emergency` 接口
- 显示哪些钱包处于应急状态
- 显示锁定该钱包的 Worker
- 显示锁的剩余时间
- 实时更新状态

**UI 组件**：
- 应急状态列表
- 倒计时显示
- Worker 标识

---

### 4. 手动触发扫描

**功能描述**：手动触发完整扫描和转账操作

**实现要点**：
- 调用 `POST /scan` 接口
- 需要提供 API Key
- 显示扫描进度
- 显示扫描结果摘要
- 错误提示和处理

**UI 组件**：
- 扫描按钮
- 进度条
- 结果摘要卡片
- 错误提示框

**安全机制**：
- API Key 输入框（加密存储）
- 确认对话框
- 权限验证

---

### 5. Worker 重启

**功能描述**：手动重启 Worker，清除分布式锁

**实现要点**：
- 调用 `POST /restart` 接口
- 需要提供 API Key
- 显示重启进度
- 显示执行的操作列表
- 成功提示

**UI 组件**：
- 重启按钮
- 操作列表
- 成功/失败提示

**安全机制**：
- API Key 验证
- 二次确认
- 操作日志记录

---

### 6. 健康检查

**功能描述**：检查 Worker 运行状态

**实现要点**：
- 调用 `GET /health` 接口
- 显示 Worker 状态
- 显示 Worker ID
- 显示时间戳
- 定期自动检查

**UI 组件**：
- 状态指示灯
- Worker 信息卡片
- 最后检查时间

---

### 7. API 密钥管理

**功能描述**：安全存储和管理 API Key

**实现要点**：
- 安全存储 API Key（localStorage 加密）
- 支持多个 Worker 的 API Key
- 隐藏显示（默认显示为 ****）
- 支持修改和删除

**UI 组件**：
- API Key 输入框
- 显示/隐藏切换
- 保存按钮

**安全机制**：
- 不在代码中硬编码
- 加密存储
- 仅客户端使用

---

## 技术栈选择

### 方案 A：纯 HTML + CSS + JavaScript（推荐）

**优点**：
- 轻量级，部署简单
- 不需要构建工具
- 可以直接部署到 Cloudflare Pages
- 与 Worker 无缝集成

**缺点**：
- 状态管理较为手动
- 组件复用性低

**技术栈**：
- 原生 JavaScript (ES6+)
- CSS3 (Flexbox/Grid)
- 可选：轻量级 UI 框架（如 Tailwind CSS）

**部署方式**：
- Cloudflare Pages
- GitHub Pages
- 或与 Worker 一起部署

---

### 方案 B：React + Vite

**优点**：
- 组件化开发
- 丰富的生态系统
- 状态管理方便
- 开发体验好

**缺点**：
- 需要构建步骤
- 打包体积较大
- 部署相对复杂

**技术栈**：
- React 18
- Vite
- React Router
- Zustand/Redux（状态管理）
- Tailwind CSS / shadcn/ui

**部署方式**：
- Cloudflare Pages
- Vercel
- Netlify

---

### 方案 C：Vue 3 + Vite

**优点**：
- 学习曲线平缓
- 组件化开发
- 中文文档丰富
- 生态完善

**缺点**：
- 需要构建步骤
- 相对 React 生态略小

**技术栈**：
- Vue 3
- Vite
- Vue Router
- Pinia（状态管理）
- Element Plus / TDesign

**部署方式**：
- Cloudflare Pages
- Vercel
- Netlify

---

## 推荐方案

考虑到项目的轻量级要求和 Cloudflare 环境，**推荐使用方案 A（纯 HTML + CSS + JavaScript）**。

**理由**：
1. 前端功能相对简单，不需要复杂的组件化
2. 可以直接部署到 Cloudflare Pages，与 Worker 同域
3. 无需构建，开发部署速度快
4. 代码体积小，加载快

---

## 项目结构

```
frontend/
├── index.html              # 主页面
├── css/
│   ├── styles.css         # 主样式
│   └── variables.css      # CSS 变量
├── js/
│   ├── api.js            # API 调用封装
│   ├── app.js            # 主应用逻辑
│   ├── components.js      # UI 组件
│   └── utils.js          # 工具函数
├── assets/
│   └── images/           # 图片资源
└── README.md             # 前端说明文档
```

---

## API 调用封装

### api.js 结构

```javascript
// API 配置
const API_CONFIG = {
  main: 'https://worker-integrated-pool.3813518962.workers.dev',
  backup: 'https://integrated-pool-2.2238642875.workers.dev'
}

// API 调用封装
class WorkerAPI {
  constructor(baseUrl) {
    this.baseUrl = baseUrl
    this.apiKey = this.loadApiKey()
  }

  // 加载 API Key
  loadApiKey() {
    return localStorage.getItem('worker_api_key') || ''
  }

  // 保存 API Key
  saveApiKey(key) {
    localStorage.setItem('worker_api_key', key)
    this.apiKey = key
  }

  // 通用请求方法
  async request(endpoint, options = {}) {
    const url = `${this.baseUrl}${endpoint}`
    
    // 如果需要认证，添加 API Key
    if (options.requireAuth) {
      options.headers = {
        ...options.headers,
        'X-API-Key': this.apiKey
      }
    }

    const response = await fetch(url, options)
    
    if (!response.ok) {
      throw new Error(`HTTP ${response.status}: ${response.statusText}`)
    }

    return await response.json()
  }

  // 获取健康状态
  async getHealth() {
    return this.request('/health')
  }

  // 获取钱包状态
  async getStatus() {
    return this.request('/status')
  }

  // 获取单个钱包详情
  async getWallet(address) {
    return this.request(`/wallet?address=${address}`)
  }

  // 获取应急状态
  async getEmergency() {
    return this.request('/emergency')
  }

  // 手动触发扫描
  async scan() {
    return this.request('/scan', {
      method: 'POST',
      requireAuth: true
    })
  }

  // 重启 Worker
  async restart() {
    return this.request('/restart', {
      method: 'POST',
      requireAuth: true
    })
  }
}
```

---

## UI 设计要点

### 1. 响应式设计

- 支持桌面端（1920px+）
- 支持平板端（768px - 1919px）
- 支持移动端（< 768px）

### 2. 主题设计

**主色调**：
- 主色：蓝色（信任、稳定）
- 成功色：绿色
- 警告色：橙色
- 错误色：红色
- 应急色：紫色

**布局**：
- 顶部导航栏
- 侧边栏（桌面端）
- 主内容区
- 状态栏（底部）

### 3. 组件设计

**卡片组件**：
```html
<div class="card">
  <div class="card-header">
    <h3>钱包 0x8e16</h3>
    <span class="status-badge emergency">应急</span>
  </div>
  <div class="card-body">
    <div class="balance-item">
      <span class="label">BNB</span>
      <span class="value">0.001</span>
    </div>
    <div class="balance-item">
      <span class="label">wkeyDAO</span>
      <span class="value">100</span>
    </div>
  </div>
</div>
```

**按钮组件**：
- 主要按钮（实心）
- 次要按钮（描边）
- 危险按钮（红色）
- 加载状态（禁用 + spinner）

---

## 安全考虑

### 1. API Key 存储

```javascript
// 加密存储（使用 Web Crypto API）
async function encryptApiKey(key, password) {
  // 实现加密逻辑
}

async function decryptApiKey(encryptedKey, password) {
  // 实现解密逻辑
}
```

### 2. CORS 配置

Worker 需要允许前端跨域访问：
```javascript
// 在 Worker 的 fetch 处理中添加 CORS 头
const corsHeaders = {
  'Access-Control-Allow-Origin': '*',
  'Access-Control-Allow-Methods': 'GET, POST, OPTIONS',
  'Access-Control-Allow-Headers': 'Content-Type, X-API-Key'
}
```

### 3. 请求验证

- 验证 API Key 格式
- 验证钱包地址格式
- 验证输入参数

---

## 开发步骤

### 阶段 1：基础设施（第1-2天）
1. 创建前端项目结构
2. 配置开发环境
3. 实现 API 调用封装
4. 实现基础 UI 组件

### 阶段 2：核心功能（第3-5天）
1. 实现钱包状态监控
2. 实现单个钱包详情
3. 实现应急状态监控
4. 实现健康检查

### 阶段 3：危险操作（第6-7天）
1. 实现 API Key 管理
2. 实现手动触发扫描
3. 实现Worker重启
4. 添加安全验证

### 阶段 4：优化和部署（第8-10天）
1. UI/UX 优化
2. 响应式适配
3. 性能优化
4. 部署到 Cloudflare Pages
5. 测试和修复

---

## 部署方案

### 方案 1：Cloudflare Pages（推荐）

**步骤**：
1. 创建 GitHub 仓库
2. 连接到 Cloudflare Pages
3. 配置构建设置
4. 自动部署

**优势**：
- 免费
- 全球 CDN
- 与 Worker 同域
- 自动 HTTPS

### 方案 2：部署到 Worker

**步骤**：
1. 在 Worker 中添加静态资源路由
2. 返回 HTML/CSS/JS
3. 修改 Worker 代码

**优势**：
- 与 Worker 完全集成
- 单一入口
- 无需额外部署

**缺点**：
- Worker 代码变复杂
- 静态资源与逻辑混合

---

## 部署配置

### Worker 配置

**Worker 名称**: `integrated-pool-2`
**账户 ID**: `ef9cd986c28831a3f85041a8cf08990a`
**API Token**: 从账户管理页面获取（不要在文档中硬编码）

### API 端点配置

```javascript
// frontend/js/api.js
const API_CONFIG = {
  main: 'https://api.weare.run',
  backup: 'https://integrated-pool-2.2238642875.workers.dev'
}
```

**注意事项**:
- 主地址 `api.weare.run` 需要关闭 Cloudflare 攻击模式
- 备用地址为 Worker 原始 URL，用于主地址不可用时切换

### 部署命令

```bash
cd /workspace/cloudflare/integrated-pool-2
export CLOUDFLARE_API_TOKEN="<your-api-token>"
export CLOUDFLARE_ACCOUNT_ID="ef9cd986c28831a3f85041a8cf08990a"
npx wrangler deploy
```

---

## 相关文档

- [Worker-Integrated-Pool-API文档.md](./Worker-Integrated-Pool-API文档.md) - 后端 API 文档
- [项目愿景与规划](../../通用文档/项目愿景与规划.md) - 项目总体规划

---

## 注意事项

1. **安全性**：不要在前端代码中硬编码 API Key
2. **性能**：合理使用缓存，避免频繁请求
3. **兼容性**：确保在主流浏览器中正常运行
4. **可维护性**：代码结构清晰，注释完整
5. **用户体验**：提供清晰的错误提示和操作反馈

---

**最后更新**: 2026-02-02
