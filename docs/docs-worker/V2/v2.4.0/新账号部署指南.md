# æ–°è´¦å·éƒ¨ç½²æŒ‡å—

**ç‰ˆæœ¬**: v2.4.0-dev  
**æ—¥æœŸ**: 2026-01-31

---

## æ¦‚è¿°

æœ¬æŒ‡å—ç”¨äºåœ¨æ–°çš„ Cloudflare è´¦å·ä¸Šéƒ¨ç½² worker-integrated-poolï¼ˆv2.4.0-dev ç‰ˆæœ¬ï¼‰ã€‚

---

## 1. ä»£ç å‡†å¤‡

### 1.1 å…‹éš†æˆ–åˆ‡æ¢åˆ° v2.4.0-dev åˆ†æ”¯

```bash
# å…‹éš†ä»“åº“ï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰
git clone https://cnb.cool/xplan-aide/X-plan.git
cd X-plan

# åˆ‡æ¢åˆ° v2.4.0-dev åˆ†æ”¯
git checkout v2.4.0-dev
git pull origin v2.4.0-dev
```

### 1.2 ç¡®è®¤å¹¶ä¿®æ”¹ wrangler.toml é…ç½®

ç¼–è¾‘ `cloudflare/worker-integrated-pool/wrangler.toml`ï¼š

```toml
name = "worker-integrated-pool"
main = "src/index.js"
compatibility_date = "2025-01-16"
account_id = "ä½ çš„æ–°è´¦å·çš„Account ID"  # âš ï¸ å¿…é¡»ä¿®æ”¹
```

#### è·å–æ–°è´¦å·çš„ Account ID

**æ–¹æ³•1ï¼šé€šè¿‡ Dashboard**
1. ç™»å½•æ–°è´¦å·çš„ [Cloudflare Dashboard](https://dash.cloudflare.com)
2. è¿›å…¥ **Workers & Pages**
3. ç‚¹å‡»ä»»æ„ workerï¼ˆæˆ–åˆ›å»ºæµ‹è¯• workerï¼‰
4. åœ¨å³ä¾§è¾¹æ å¯ä»¥çœ‹åˆ° **Account ID**

**æ–¹æ³•2ï¼šé€šè¿‡ CLI**
```bash
# å…ˆç™»å½•æ–°è´¦å·
npx wrangler logout
npx wrangler login

# æŸ¥çœ‹è´¦å·ä¿¡æ¯
npx wrangler whoami
```

è¾“å‡ºç¤ºä¾‹ï¼š
```
ğŸ‘‹ You are logged in with an Account API Token, associated with the account email@example.com's Account.
â„¹ï¸  The API Token is read from the CLOUDFLARE_API_TOKEN environment variable.
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Account Name                â”‚ Account ID                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ email@example.com's Account â”‚ 7d8c0fb0cc70cda866c1f942a543417c â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. åˆ›å»ºå¿…éœ€çš„ KV å‘½åç©ºé—´

åœ¨æ–°è´¦å·ä¸­åˆ›å»º 2 ä¸ª KV å‘½åç©ºé—´ã€‚

### 2.1 æ–¹æ³•1ï¼šä½¿ç”¨ CLIï¼ˆæ¨èï¼‰

```bash
cd /workspace/cloudflare/worker-integrated-pool

# ç¡®ä¿å·²ç™»å½•æ–°è´¦å·
npx wrangler logout
npx wrangler login

# åˆ›å»ºç¬¬ä¸€ä¸ª KV å‘½åç©ºé—´
npx wrangler kv:namespace create "EMERGENCY_STORE"

# åˆ›å»ºç¬¬äºŒä¸ª KV å‘½åç©ºé—´
npx wrangler kv:namespace create "RPC_POOL"
```

è¾“å‡ºç¤ºä¾‹ï¼š
```
ğŸŒ€ Creating namespace with title "EMERGENCY_STORE_MyAwesomeWorker"
âœ¨ Success!
Add the following to your configuration file in your kv_namespaces array:
{ binding = "EMERGENCY_STORE", id = "abc1234567890...", preview_id = "" }

ğŸŒ€ Creating namespace with title "RPC_POOL_MyAwesomeWorker"
âœ¨ Success!
Add the following to your configuration file in your kv_namespaces array:
{ binding = "RPC_POOL", id = "def9876543210...", preview_id = "" }
```

**é‡è¦**ï¼šè®°å½•è¾“å‡ºçš„ `id` å€¼ï¼Œåç»­é…ç½®éœ€è¦ç”¨åˆ°ã€‚

### 2.2 æ–¹æ³•2ï¼šä½¿ç”¨ Dashboard

1. ç™»å½• [Cloudflare Dashboard](https://dash.cloudflare.com)
2. è¿›å…¥ **Workers & Pages** â†’ **KV**
3. ç‚¹å‡» **"Create a Namespace"**
4. è¾“å…¥åç§°ï¼š`EMERGENCY_STORE`ï¼Œç‚¹å‡» **Add**
5. é‡å¤æ­¥éª¤ï¼Œåˆ›å»ºç¬¬äºŒä¸ªï¼š`RPC_POOL`
6. ç‚¹å‡»åˆ›å»ºçš„å‘½åç©ºé—´ï¼Œè®°å½• **Namespace ID**

### 2.3 æ›´æ–° wrangler.toml

å°†è·å¾—çš„ KV Namespace ID å¡«å…¥ `wrangler.toml`ï¼š

```toml
# KVå‘½åç©ºé—´ç»‘å®š
[[kv_namespaces]]
binding = "EMERGENCY_STORE"
id = "ä½ çš„EMERGENCY_STORE_ID"  # âš ï¸ æ›¿æ¢ä¸ºå®é™…ID
preview_id = ""

[[kv_namespaces]]
binding = "RPC_POOL"
id = "ä½ çš„RPC_POOL_ID"  # âš ï¸ æ›¿æ¢ä¸ºå®é™…ID
preview_id = ""
```

---

## 3. é…ç½®ç¯å¢ƒå˜é‡

### 3.1 åœ¨ wrangler.toml ä¸­é…ç½®åŸºç¡€å˜é‡

ç¼–è¾‘ `cloudflare/worker-integrated-pool/wrangler.toml`ï¼Œä¿®æ”¹ä»¥ä¸‹å¿…éœ€é¡¹ï¼š

```toml
[vars]
WORKER_ID = "worker-integrated-pool"
WORKER_NAME = "Integrated-Pool"

# âš ï¸ è¢«ä¿æŠ¤é’±åŒ…åœ°å€ï¼ˆæ ¹æ®å®é™…æƒ…å†µä¿®æ”¹ï¼‰
PROTECTED_WALLETS = "0x9F4fba96e1D15f8547b9e41Be957Ff143C298e16,0x3D3914960567b3A253C429d5Ab81DA1F386F9111,0x886b739Ba73C1ccaE826Cb11c8d28e4750C68A89"

# é’±åŒ…æ‰«æé—´éš”ï¼ˆç§’ï¼‰ï¼Œ0è¡¨ç¤ºä¸é—´éš”
WALLET_SCAN_INTERVAL = "0"

# BSC RPCèŠ‚ç‚¹ï¼ˆå¯ä½¿ç”¨é»˜è®¤å€¼ï¼‰
BSC_RPC = "https://bsc-rpc.publicnode.com"
BSC_RPC_NODES = "https://bsc-rpc.publicnode.com,https://bsc-dataseed1.binance.org/,https://bsc-dataseed2.binance.org/,https://bsc-dataseed3.binance.org/,https://bsc-dataseed4.binance.org/"

# BNBé˜ˆå€¼ï¼ˆè§¦å‘åº”æ€¥çŠ¶æ€ï¼‰
BNB_THRESHOLD = "0.0005"

# æ‰«æè¶…æ—¶é…ç½®ï¼ˆæ¯«ç§’ï¼‰
MAX_SCAN_DURATION = "7000"

# âš ï¸ è½¬è´¦ç«äº‰æ¨¡å¼ï¼štrue=ä½¿ç”¨æ‰€æœ‰BNBä½œä¸ºGasè´¹ä¸Šé™
COMPETITIVE_MODE = "true"

# ä»£å¸åœ°å€ï¼ˆwkeyDAOå’ŒUSDTï¼‰
TOKEN_WKEYDAO = "0x194B302a4b0a79795Fb68E2ADf1B8c9eC5ff8d1F"
TOKEN_USDT = "0x55d398326f99059fF775485246999027B3197955"

# åº”æ€¥çŠ¶æ€é…ç½®
EMERGENCY_MAX_DURATION = "600"
EMERGENCY_SCAN_INTERVAL = "5"

# è½¬è´¦é…ç½®
MAX_TRANSFER_RETRIES = "3"
TARGET_BNB_BALANCE = "0.001"

# âš ï¸ å®‰å…¨é’±åŒ…åœ°å€ï¼ˆæ¥æ”¶è½¬å‡ºçš„èµ„äº§ï¼Œå¿…é¡»ä¿®æ”¹ï¼‰
SAFE_WALLET = "ä½ çš„å®‰å…¨é’±åŒ…åœ°å€"

# âš ï¸ Gasè¡¥å……é’±åŒ…åœ°å€ï¼ˆå¿…é¡»ä¿®æ”¹ï¼‰
GAS_FUNDING_WALLET = "ä½ çš„Gasè¡¥å……é’±åŒ…åœ°å€"
```

#### å…³é”®é…ç½®è¯´æ˜

| é…ç½®é¡¹ | è¯´æ˜ | æ˜¯å¦å¿…éœ€ä¿®æ”¹ |
|--------|------|-------------|
| `PROTECTED_WALLETS` | è¢«ç›‘æ§å’Œä¿æŠ¤çš„é’±åŒ…åœ°å€åˆ—è¡¨ | âœ… æ˜¯ |
| `SAFE_WALLET` | æ¥æ”¶è½¬å‡ºèµ„äº§çš„å®‰å…¨é’±åŒ… | âœ… æ˜¯ |
| `GAS_FUNDING_WALLET` | ç”¨äºGasè¡¥å……çš„é’±åŒ…åœ°å€ | âœ… æ˜¯ |
| `COMPETITIVE_MODE` | ç«äº‰æ¨¡å¼å¼€å…³ | âŒ å¯é€‰ï¼ˆé»˜è®¤trueï¼‰ |
| `TARGET_BNB_BALANCE` | Gasè¡¥å……ç›®æ ‡ä½™é¢ | âŒ å¯é€‰ï¼ˆé»˜è®¤0.001ï¼‰ |

---

## 4. é…ç½® Secrets

Secrets æ˜¯æ•æ„Ÿä¿¡æ¯ï¼Œä¸åº”æ˜æ–‡å­˜å‚¨åœ¨ `wrangler.toml` ä¸­ã€‚

### 4.1 æ–¹æ³•1ï¼šä½¿ç”¨ CLIï¼ˆæ¨èï¼‰

```bash
cd /workspace/cloudflare/worker-integrated-pool

# ä¾æ¬¡é…ç½®æ¯ä¸ªSecretï¼Œå‘½ä»¤ä¼šæç¤ºè¾“å…¥å€¼

# 1. Supabase é¡¹ç›® URL
npx wrangler secret put SUPABASE_URL
# è¾“å…¥: https://xxxxx.supabase.co

# 2. Supabase æœåŠ¡å¯†é’¥ï¼ˆservice_roleï¼‰
npx wrangler secret put SUPABASE_KEY
# è¾“å…¥: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...ï¼ˆä½ çš„service_role keyï¼‰

# 3. ç¬¬ä¸€ä¸ªè¢«ä¿æŠ¤é’±åŒ…çš„ç§é’¥
npx wrangler secret put WALLET_PRIVATE_KEY_0x9F4fba96e1D15f8547b9e41Be957Ff143C298e16
# è¾“å…¥: 0x1234567890abcdef...ï¼ˆé’±åŒ…ç§é’¥ï¼‰

# 4. ç¬¬äºŒä¸ªè¢«ä¿æŠ¤é’±åŒ…çš„ç§é’¥
npx wrangler secret put WALLET_PRIVATE_KEY_0x3D3914960567b3A253C429d5Ab81DA1F386F9111
# è¾“å…¥: 0xabcdef1234567890...ï¼ˆé’±åŒ…ç§é’¥ï¼‰

# 5. ç¬¬ä¸‰ä¸ªè¢«ä¿æŠ¤é’±åŒ…çš„ç§é’¥ï¼ˆå¦‚æœéœ€è¦ï¼‰
npx wrangler secret put WALLET_PRIVATE_KEY_0x886b739Ba73C1ccaE826Cb11c8d28e4750C68A89
# è¾“å…¥: 0x9876543210fedcba...ï¼ˆé’±åŒ…ç§é’¥ï¼‰

# 6. Gasè¡¥å……é’±åŒ…çš„ç§é’¥
npx wrangler secret put GAS_FUNDING_WALLET_PRIVATE_KEY
# è¾“å…¥: 0xfedcba0987654321...ï¼ˆGasé’±åŒ…ç§é’¥ï¼‰
```

### 4.2 æ–¹æ³•2ï¼šä½¿ç”¨ Dashboard

1. ç™»å½• [Cloudflare Dashboard](https://dash.cloudflare.com)
2. è¿›å…¥ **Workers & Pages** â†’ **worker-integrated-pool**
3. ç‚¹å‡» **Settings** â†’ **Variables**
4. åœ¨ **Secrets** éƒ¨åˆ†ï¼š
   - ç‚¹å‡» **"Add variable"**
   - è¾“å…¥ **Variable name**ï¼ˆå¦‚ `SUPABASE_URL`ï¼‰
   - è¾“å…¥ **Value**
   - ç‚¹å‡» **"Encrypt"** â†’ **"Save"**
5. é‡å¤æ­¥éª¤ï¼Œæ·»åŠ æ‰€æœ‰Secrets

### 4.3 Secrets åˆ—è¡¨

| Secret åç§° | è¯´æ˜ | æ˜¯å¦å¿…éœ€ |
|------------|------|---------|
| `SUPABASE_URL` | Supabase é¡¹ç›® URL | âœ… æ˜¯ |
| `SUPABASE_KEY` | Supabase æœåŠ¡å¯†é’¥ | âœ… æ˜¯ |
| `WALLET_PRIVATE_KEY_0x9F4f...` | ç¬¬ä¸€ä¸ªé’±åŒ…çš„ç§é’¥ | âœ… æ˜¯ |
| `WALLET_PRIVATE_KEY_0x3D39...` | ç¬¬äºŒä¸ªé’±åŒ…çš„ç§é’¥ | âœ… æ˜¯ |
| `WALLET_PRIVATE_KEY_0x886b...` | ç¬¬ä¸‰ä¸ªé’±åŒ…çš„ç§é’¥ | âœ… æ ¹æ®éœ€è¦ |
| `GAS_FUNDING_WALLET_PRIVATE_KEY` | Gasè¡¥å……é’±åŒ…ç§é’¥ | âœ… æ˜¯ |

---

## 5. Supabase æ•°æ®åº“å‡†å¤‡

### 5.1 åˆ›å»ºæˆ–ç¡®è®¤ Supabase é¡¹ç›®

ç¡®ä¿ä½ æœ‰å¯ç”¨çš„ Supabase é¡¹ç›®ï¼š

1. ç™»å½• [Supabase Dashboard](https://supabase.com/dashboard)
2. åˆ›å»ºæ–°é¡¹ç›®ï¼ˆæˆ–ä½¿ç”¨ç°æœ‰é¡¹ç›®ï¼‰
3. è®°å½•ä»¥ä¸‹ä¿¡æ¯ï¼š
   - **Project URL**: `https://xxxxx.supabase.co`
   - **API Key**: è¿›å…¥ Settings â†’ APIï¼Œä½¿ç”¨ **service_role** å¯†é’¥ï¼ˆä¸æ˜¯ anon å¯†é’¥ï¼‰

### 5.2 åˆ›å»ºå¿…è¦çš„è¡¨

å¦‚æœ Supabase é¡¹ç›®æ˜¯æ–°çš„ï¼Œéœ€è¦åˆ›å»ºäº¤æ˜“è®°å½•è¡¨ï¼š

**æ–¹æ³•1ï¼šé€šè¿‡ SQL Editor**
1. è¿›å…¥ Supabase Dashboard â†’ **SQL Editor**
2. ç‚¹å‡» **"New query"**
3. ç²˜è´´ä»¥ä¸‹ SQL å¹¶è¿è¡Œï¼š

```sql
-- äº¤æ˜“è®°å½•è¡¨
CREATE TABLE IF NOT EXISTS transactions (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  worker_id TEXT,
  wallet_address TEXT,
  tx_hash TEXT UNIQUE,
  token_address TEXT,
  amount NUMERIC,
  status TEXT,
  error_message TEXT,
  triggered_by TEXT,
  trigger_reason TEXT,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- åˆ›å»ºç´¢å¼•
CREATE INDEX IF NOT EXISTS idx_transactions_tx_hash ON transactions(tx_hash);
CREATE INDEX IF NOT EXISTS idx_transactions_wallet ON transactions(wallet_address);
CREATE INDEX IF NOT EXISTS idx_transactions_worker ON transactions(worker_id);
CREATE INDEX IF NOT EXISTS idx_transactions_status ON transactions(status);
CREATE INDEX IF NOT EXISTS idx_transactions_created_at ON transactions(created_at DESC);
```

**æ–¹æ³•2ï¼šé€šè¿‡ Table Editor**
1. è¿›å…¥ Supabase Dashboard â†’ **Table Editor**
2. ç‚¹å‡» **"Create a new table"**
3. è¡¨åï¼š`transactions`
4. æ·»åŠ åˆ—ï¼š
   - `worker_id` (text)
   - `wallet_address` (text)
   - `tx_hash` (text, unique)
   - `token_address` (text)
   - `amount` (numeric)
   - `status` (text)
   - `error_message` (text)
   - `triggered_by` (text)
   - `trigger_reason` (text)
   - `created_at` (timestamp with time zone)
   - `updated_at` (timestamp with time zone)

---

## 6. éƒ¨ç½² Worker

### 6.1 ç¡®è®¤é…ç½®æ­£ç¡®

```bash
cd /workspace/cloudflare/worker-integrated-pool

# æŸ¥çœ‹æœ€ç»ˆé…ç½®
cat wrangler.toml
```

### 6.2 æ‰§è¡Œéƒ¨ç½²

```bash
# éƒ¨ç½²åˆ°æ–°è´¦å·
npx wrangler deploy
```

é¢„æœŸè¾“å‡ºï¼š
```
 â›…ï¸ wrangler 4.61.1
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Total Upload: 883.71 KiB / gzip: 226.59 KiB
Worker Startup Time: 6 ms
Your Worker has access to following bindings:
Binding                        Resource
env.EMERGENCY_STORE            KV Namespace
env.RPC_POOL                   KV Namespace
...
Uploaded worker-integrated-pool (3.23 sec)
Deployed worker-integrated-pool triggers (1.74 sec)
  https://worker-integrated-pool.ä½ çš„å­åŸŸå.workers.dev
  schedule: * * * * *
Current Version ID: 841ffc0c-5fef-4678-8c03-13be73c5309a
```

### 6.3 ä½¿ç”¨ API Token éƒ¨ç½²ï¼ˆå¦‚æœéœ€è¦ï¼‰

```bash
# è®¾ç½®ç¯å¢ƒå˜é‡
export CLOUDFLARE_API_TOKEN="ä½ çš„æ–°è´¦å·çš„API Token"
export CLOUDFLARE_ACCOUNT_ID="ä½ çš„æ–°è´¦å·çš„Account ID"

# éƒ¨ç½²
npx wrangler deploy
```

**è·å– API Token**ï¼š
1. ç™»å½• [Cloudflare Dashboard](https://dash.cloudflare.com)
2. è¿›å…¥ **My Profile** â†’ **API Tokens**
3. ç‚¹å‡» **"Create Token"**
4. æ¨¡æ¿ï¼š**Edit Cloudflare Workers** æˆ– **Custom token**
5. æƒé™ï¼š**Account** â†’ **Cloudflare Workers: Edit**
6. åˆ›å»ºå¹¶å¤åˆ¶ Token

---

## 7. éªŒè¯éƒ¨ç½²

### 7.1 æ£€æŸ¥ Worker çŠ¶æ€

```bash
# æŸ¥çœ‹æœ€è¿‘éƒ¨ç½²
npx wrangler deployments list
```

### 7.2 å®æ—¶æŸ¥çœ‹æ—¥å¿—

```bash
# ç›‘æ§ worker æ—¥å¿—ï¼ˆCtrl+C é€€å‡ºï¼‰
npx wrangler tail
```

é¢„æœŸçœ‹åˆ°ç±»ä¼¼è¾“å‡ºï¼š
```
ğŸš€ [worker-integrated-pool] å¼€å§‹å®šæ—¶æ‰«æ
ğŸ“Š [TacticsScanner] æ‰«æç»“æœ: { BNB: "0.123", wkeyDAO: "0", USDT: "0" }
âœ… [worker-integrated-pool] æ‰«æå®Œæˆ: 0x9F4f... (è€—æ—¶: 1234ms)
```

### 7.3 è®¿é—® Worker URL

åœ¨æµè§ˆå™¨ä¸­è®¿é—®ï¼š
```
https://worker-integrated-pool.ä½ çš„å­åŸŸå.workers.dev
```

åº”è¯¥çœ‹åˆ°å“åº”ï¼š
```json
{
  "status": "ok",
  "message": "X-plan Asset Protection System v2.4.0-dev"
}
```

### 7.4 éªŒè¯ Cron Trigger

ç¡®è®¤ Worker çš„ scheduled task æ­£å¸¸è§¦å‘ï¼ˆæ¯åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ï¼‰ã€‚

æŸ¥çœ‹æ—¥å¿—ï¼Œç¡®è®¤æ¯åˆ†é’Ÿéƒ½æœ‰æ–°çš„æ‰«æè®°å½•ã€‚

### 7.5 æµ‹è¯• HTTP ç«¯ç‚¹

æ‰‹åŠ¨è§¦å‘æ‰«æï¼ˆæµ‹è¯•ç”¨ï¼‰ï¼š

```bash
# POST è¯·æ±‚
curl -X POST https://worker-integrated-pool.ä½ çš„å­åŸŸå.workers.dev \
  -H "Content-Type: application/json" \
  -d '{}'
```

---

## 8. æ•…éšœæ’æŸ¥

### 8.1 å¸¸è§é”™è¯¯

#### é”™è¯¯1ï¼šInvalid URL: undefined/rest/v1/

**åŸå› **ï¼š`SUPABASE_URL` Secret æœªé…ç½®

**è§£å†³**ï¼šè¿è¡Œ `npx wrangler secret put SUPABASE_URL` é…ç½® Supabase URL

---

#### é”™è¯¯2ï¼šPrivate key not found for wallet

**åŸå› **ï¼šé’±åŒ…ç§é’¥ Secret æœªé…ç½®æˆ–åç§°é”™è¯¯

**è§£å†³**ï¼šæ£€æŸ¥ Secret åç§°æ˜¯å¦ä¸º `WALLET_PRIVATE_KEY_0x<é’±åŒ…åœ°å€>`

---

#### é”™è¯¯3ï¼šKV Namespace not found

**åŸå› **ï¼š`wrangler.toml` ä¸­çš„ KV Namespace ID é”™è¯¯

**è§£å†³**ï¼š
1. è¿è¡Œ `npx wrangler kv:namespace list` æŸ¥çœ‹å®é™…ID
2. æ›´æ–° `wrangler.toml` ä¸­çš„ID
3. é‡æ–°éƒ¨ç½²

---

#### é”™è¯¯4ï¼šNo protected wallets configured

**åŸå› **ï¼š`PROTECTED_WALLETS` ç¯å¢ƒå˜é‡ä¸ºç©º

**è§£å†³**ï¼šåœ¨ `wrangler.toml` çš„ `[vars]` ä¸­é…ç½®é’±åŒ…åœ°å€

---

### 8.2 è°ƒè¯•æŠ€å·§

#### æŸ¥çœ‹å®Œæ•´é…ç½®
```bash
npx wrangler secret list
```

#### æŸ¥çœ‹éƒ¨ç½²è¯¦æƒ…
```bash
npx wrangler deploy --dry-run
```

#### æœ¬åœ°æµ‹è¯•
```bash
# æœ¬åœ°è¿è¡Œ workerï¼ˆä½¿ç”¨ wrangler.toml é…ç½®ï¼‰
npx wrangler dev
```

---

## 9. å®‰å…¨å»ºè®®

### 9.1 ç§é’¥å®‰å…¨

âš ï¸ **é‡è¦æé†’**ï¼š
- Secrets é…ç½®åæ— æ³•åœ¨ Dashboard ä¸­æŸ¥çœ‹
- ç¡®ä¿ Wallet Private Key æœ‰å®‰å…¨çš„å¤‡ä»½
- å»ºè®®ä½¿ç”¨ä¸“é—¨çš„ç§é’¥ç®¡ç†å·¥å…·
- ä¸è¦åœ¨ä»»ä½•ä»£ç æˆ–æ—¥å¿—ä¸­è¾“å‡ºç§é’¥

### 9.2 Supabase å®‰å…¨

- ä½¿ç”¨ **service_role** å¯†é’¥ï¼ˆå…·æœ‰å®Œæ•´æƒé™ï¼‰
- å®šæœŸè½®æ¢ API Key
- é™åˆ¶æ•°æ®åº“è®¿é—® IPï¼ˆå¦‚éœ€è¦ï¼‰
- å¯ç”¨æ•°æ®åº“åŠ å¯†

### 9.3 Cloudflare å®‰å…¨

- ä½¿ç”¨ API Token è€Œä¸æ˜¯è´¦æˆ·å¯†ç 
- å®šæœŸè½®æ¢ API Token
- å¯ç”¨ 2FAï¼ˆåŒå› ç´ è®¤è¯ï¼‰
- ç›‘æ§ Worker è°ƒç”¨æ—¥å¿—

---

## 10. å‡†å¤‡æ¸…å•

å®Œæˆä»¥ä¸‹æ‰€æœ‰é¡¹ç›®åï¼Œéƒ¨ç½²å³å‡†å¤‡å°±ç»ªï¼š

### ä»£ç å‡†å¤‡
- [ ] 1.1 å…‹éš†/åˆ‡æ¢åˆ° v2.4.0-dev åˆ†æ”¯
- [ ] 1.2 ä¿®æ”¹ `wrangler.toml` ä¸­çš„ `account_id`

### èµ„æºå‡†å¤‡
- [ ] 2.1 åˆ›å»º KV å‘½åç©ºé—´ï¼ˆEMERGENCY_STOREï¼‰
- [ ] 2.2 åˆ›å»º KV å‘½åç©ºé—´ï¼ˆRPC_POOLï¼‰
- [ ] 2.3 æ›´æ–° KV Namespace ID åˆ° `wrangler.toml`

### ç¯å¢ƒå˜é‡
- [ ] 3.1 é…ç½® `PROTECTED_WALLETS`
- [ ] 3.2 é…ç½® `SAFE_WALLET`
- [ ] 3.3 é…ç½® `GAS_FUNDING_WALLET`
- [ ] 3.4 ç¡®è®¤å…¶ä»–é…ç½®é¡¹æ­£ç¡®

### Secrets
- [ ] 4.1 é…ç½® `SUPABASE_URL`
- [ ] 4.2 é…ç½® `SUPABASE_KEY`
- [ ] 4.3 é…ç½®æ‰€æœ‰é’±åŒ…ç§é’¥ Secrets
- [ ] 4.4 é…ç½® `GAS_FUNDING_WALLET_PRIVATE_KEY`

### Supabase
- [ ] 5.1 ç¡®è®¤ Supabase é¡¹ç›® URL å’Œ Key
- [ ] 5.2 åˆ›å»º `transactions` è¡¨
- [ ] 5.3 åˆ›å»ºå¿…è¦çš„ç´¢å¼•

### éƒ¨ç½²
- [ ] 6.1 ç¡®è®¤æ‰€æœ‰é…ç½®æ­£ç¡®
- [ ] 6.2 æ‰§è¡Œ `npx wrangler deploy`
- [ ] 6.3 è®°å½• Worker URL

### éªŒè¯
- [ ] 7.1 æŸ¥çœ‹éƒ¨ç½²åˆ—è¡¨
- [ ] 7.2 æŸ¥çœ‹å®æ—¶æ—¥å¿—
- [ ] 7.3 è®¿é—® Worker URL
- [ ] 7.4 ç¡®è®¤ Cron æ­£å¸¸è§¦å‘

---

## 11. å¿«é€Ÿéƒ¨ç½²è„šæœ¬

åˆ›å»º `deploy.sh` è‡ªåŠ¨åŒ–éƒ¨ç½²æµç¨‹ï¼š

```bash
#!/bin/bash
# worker-integrated-pool æ–°è´¦å·éƒ¨ç½²è„šæœ¬

set -e

echo "========================================="
echo "  Worker-Integrated-Pool éƒ¨ç½²è„šæœ¬"
echo "  ç‰ˆæœ¬: v2.4.0-dev"
echo "========================================="

# 1. æ£€æŸ¥é…ç½®
echo ""
echo "ğŸ“‹ æ­¥éª¤1: æ£€æŸ¥é…ç½®..."
if [ ! -f "wrangler.toml" ]; then
  echo "âŒ é”™è¯¯: wrangler.toml æ–‡ä»¶ä¸å­˜åœ¨"
  exit 1
fi

# æ£€æŸ¥ account_id
if grep -q 'account_id = ""' wrangler.toml; then
  echo "âŒ é”™è¯¯: account_id æœªé…ç½®"
  exit 1
fi

echo "âœ… é…ç½®æ£€æŸ¥é€šè¿‡"

# 2. æ£€æŸ¥ Secrets
echo ""
echo "ğŸ” æ­¥éª¤2: æ£€æŸ¥ Secrets..."
if ! npx wrangler secret list | grep -q "SUPABASE_URL"; then
  echo "âš ï¸  è­¦å‘Š: SUPABASE_URL æœªé…ç½®"
  echo "   è¿è¡Œ: npx wrangler secret put SUPABASE_URL"
fi

if ! npx wrangler secret list | grep -q "SUPABASE_KEY"; then
  echo "âš ï¸  è­¦å‘Š: SUPABASE_KEY æœªé…ç½®"
  echo "   è¿è¡Œ: npx wrangler secret put SUPABASE_KEY"
fi

# 3. éƒ¨ç½²
echo ""
echo "ğŸš€ æ­¥éª¤3: éƒ¨ç½² Worker..."
npx wrangler deploy

# 4. æ˜¾ç¤ºç»“æœ
echo ""
echo "========================================="
echo "  éƒ¨ç½²å®Œæˆï¼"
echo "========================================="
echo ""
echo "ğŸ“Š åç»­æ­¥éª¤:"
echo "   1. æŸ¥çœ‹: npx wrangler deployments list"
echo "   2. æ—¥å¿—: npx wrangler tail"
echo "   3. æµ‹è¯•: curl -X POST <worker-url>"
echo ""
```

ä½¿ç”¨æ–¹æ³•ï¼š
```bash
chmod +x deploy.sh
./deploy.sh
```

---

## é™„å½•

### A. å‚è€ƒæ–‡æ¡£

- [æ‰©å±•æ± æ¶æ„è¯´æ˜](./æ‰©å±•æ± æ¶æ„è¯´æ˜.md)
- [èµ„äº§ä¿æŠ¤æˆåŠŸç‡è¯„ä¼°](./èµ„äº§ä¿æŠ¤æˆåŠŸç‡è¯„ä¼°æŠ¥å‘Š.md)
- [äº¤æ˜“ç«äº‰ç­–ç•¥è¯´æ˜](./äº¤æ˜“ç«äº‰ç­–ç•¥è¯´æ˜.md)
- [ä»£ç å®¡è®¡æŠ¥å‘Š](./ä»£ç å®¡è®¡æŠ¥å‘Š-æœ€ç»ˆ.md)

### B. æŠ€æœ¯æ”¯æŒ

é‡åˆ°é—®é¢˜æ—¶ï¼š
1. æŸ¥çœ‹ Worker æ—¥å¿—ï¼š`npx wrangler tail`
2. æŸ¥çœ‹å®¡è®¡æŠ¥å‘Šï¼š`./ä»£ç å®¡è®¡æŠ¥å‘Š-æœ€ç»ˆ.md`
3. æ£€æŸ¥é…ç½®æ–‡ä»¶ï¼š`wrangler.toml`

### C. ç‰ˆæœ¬ä¿¡æ¯

| é¡¹ç›® | ç‰ˆæœ¬ |
|------|------|
| Cloudflare Workers | v4.x |
| Wrangler CLI | 4.61.1 |
| Node.js | 20.x |
| Ethers.js | 6.13.0 |

---

**æœ€åæ›´æ–°**: 2026-01-31  
**ç»´æŠ¤è€…**: X-plan Team
