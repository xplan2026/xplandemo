# X-plan Demo 项目背景与功能说明

## 📌 项目目标

本项目旨在模拟和演示在区块链环境下，当用户钱包私钥被盗后，如何通过自动化 worker 服务实现资产的抢先转移保护功能。

### 核心功能
模拟钱包私钥被盗场景，演示智能合约资产（XPD 代币）的安全保护机制。

---

## 📚 名词定义

### 被保护地址 A
- **定义**: 模拟私钥被盗的钱包地址
- **用途**: 持有待保护的 XPD 代币资产
- **展示方式**: 前端页面公示地址及私钥
- **⚠️ 安全提示**: 请测试者使用干净且无真实资产的钱包进行测试，导入私钥有安全风险！

### 安全地址 B
- **定义**: Worker 执行资产转移的目标安全地址
- **用途**: 在检测到资产异常时，Worker 自动将资产转移到此地址
- **配置方式**: 通过 Worker 配置文件设置

### Gas 费地址 C（扩展功能）
- **定义**: 存储 POL（Polygon）代币的 Gas 费补充地址
- **用途**:
  - 手动从水龙头网站向 C 转入 POL
  - Worker 在转移资产到 B 的同时，将多余的 POL 转移到 C
  - 确保 Worker 有足够的 Gas 费执行保护操作

### Gas 费说明
- 本项目部署在 **Polygon Amoy 测试网**
- 使用的 Gas 费为 **POL 代币**
- 所有链上操作均需消耗 Gas 费

### 应急状态（Emergency Mode）
- **定义**: Worker 的保护模式开关
- **功能**:
  - 启用时执行高频扫描（5秒/次）
  - 触发条件满足时自动转移资产到安全地址 B
  - 对比测试者手动操作的速度优势

---

## 🎮 资产被盗模拟流程

### 1. 初始化阶段
- 前端页面展示被保护地址 A 的公钥和私钥
- 地址 A 持有一定数量的 XPD 代币
- 测试者通过导入私钥获得对地址 A 的操作权限

### 2. 攻击模拟
- 测试者扮演攻击者角色
- 使用地址 A 的私钥发起资产转移操作
- 尝试将 XPD 代币转移到自己的钱包地址

### 3. 对比测试
- **应急状态关闭**: 测试者手动转移资产的成功率较高
- **应急状态开启**: Worker 抢先转移资产，测试者手动转移失败

---

## 🤖 Worker 抢先转移资产实现

### 功能架构

#### 1. 前端控制界面
```
[启动应急状态] / [关闭应急状态] 按钮
- 点击启动：激活 Worker 应急保护
- 点击关闭：暂停 Worker 应急保护
```

#### 2. Worker 任务调度

**常规任务**（应急状态关闭时）:
- 执行频率: 每分钟 1 次
- 功能: 扫描地址 A 的 XPD 代币余额
- 目的: 监控资产状态，不执行转移操作

**应急任务**（应急状态开启时）:
- 执行频率: 每 5 秒 1 次
- 功能:
  1. 扫描地址 A 的 XPD 代币余额
  2. 检测余额是否大于阈值
  3. 如有资产，立即发起转账到安全地址 B
  4. 同步处理剩余 POL 的转移
- 目的: 抢在攻击者之前转移资产

### 执行流程图

```
┌─────────────────────────────────────────────────────────────┐
│                      Worker 运行流程                         │
└─────────────────────────────────────────────────────────────┘
                              │
                    应急状态是否开启？
                              │
              ┌───────────────┴───────────────┐
              │ 否                           │ 是
              ▼                              ▼
    ┌─────────────────┐            ┌─────────────────┐
    │  常规任务模式   │            │  应急任务模式   │
    │  (1分钟/次)     │            │  (5秒/次)       │
    └────────┬────────┘            └────────┬────────┘
             │                              │
             ▼                              ▼
    ┌─────────────────┐            ┌─────────────────┐
    │ 扫描地址A余额   │            │ 扫描地址A余额   │
    │ 仅监控，不操作  │            │ 实时监控        │
    └─────────────────┘            └────────┬────────┘
                                           │
                                    余额 > 0 ?
                                           │
                              ┌─────────────┴─────────────┐
                              │ 否                     │ 是
                              ▼                        ▼
                    ┌─────────────────┐    ┌─────────────────┐
                    │  结束本次扫描   │    │  立即转移资产   │
                    └─────────────────┘    └────────┬────────┘
                                                 │
                                                 ▼
                                    ┌─────────────────┐
                                    │ 转移 XPD 到 B   │
                                    │ 转移 POL 到 C   │
                                    └─────────────────┘
```

---

## 🔒 安全机制说明

### 1. 抢先转移原理
- Worker 通过高频扫描（5秒间隔）实时监控地址 A
- 一旦检测到资产，立即发起转账交易
- 相比人工操作，Worker 的响应速度更快

### 2. Gas 费管理
- Worker 从地址 C 获取足够的 POL 作为 Gas 费
- 确保在任何情况下都能执行保护操作
- 避免因 Gas 费不足导致保护失败

### 3. 地址安全
- 地址 A: 公开地址和私钥，用于模拟被盗
- 地址 B: 私钥保密，存储转出的资产
- 地址 C: 专门管理 Gas 费，与资产分离

---

## 🎯 演示效果

### 场景 1: 应急状态关闭
```
测试者 → 导入A的私钥 → 发起转账 → 转账成功 ✅
Worker → 每分钟扫描 → 不执行转移 → 无保护 ❌
结果: 资产被盗
```

### 场景 2: 应急状态开启
```
测试者 → 导入A的私钥 → 发起转账
Worker → 5秒扫描 → 检测到余额 → 抢先转账 → 转账成功 ✅
测试者 → 发起转账 → 余额为0 → 转账失败 ❌
结果: 资产被安全转移
```

---

## 🛠️ 技术实现要点

### 1. 智能合约交互
- 读取 ERC20 代币余额
- 执行代币转账
- 签名和发送交易

### 2. Worker 开发
- Cloudflare Worker Cron Triggers
- 实时监控和响应
- 交易队列管理

### 3. 前端实现
- Web3 钱包连接
- 私钥导入（测试用途）
- 实时余额显示
- 应急状态控制

### 4. 数据库存储
- 记录交易日志
- 存储监控状态
- 追踪操作历史

---

## ⚠️ 重要提示

1. **仅供测试**: 本项目演示在测试网进行，切勿在主网使用真实资产
2. **私钥安全**: 导入私钥功能仅用于演示，实际生产环境中严禁在浏览器暴露私钥
3. **Gas 费准备**: 测试前请确保地址 C 有足够的 POL 作为 Gas 费
4. **法律责任**: 本项目仅用于技术演示，不承担任何实际资产损失责任

---

## 📊 项目预期成果

1. ✅ 演示自动化资产保护的有效性
2. ✅ 验证 Worker 在区块链安全场景的应用价值
3. ✅ 为用户提供链上资产保护的技术参考
4. ✅ 推广区块链安全防护意识

---

最后更新: 2026-02-07
