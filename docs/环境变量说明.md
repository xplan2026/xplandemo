# ç¯å¢ƒå˜é‡é…ç½®è¯´æ˜

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£è¯´æ˜ X-plan Demo é¡¹ç›®ä¸­ç¯å¢ƒå˜é‡çš„é…ç½®å’Œä½¿ç”¨æ–¹æ³•ã€‚

---

## ğŸš¨ å®‰å…¨è­¦å‘Š

âš ï¸ **é‡è¦**ï¼š
1. `.env` æ–‡ä»¶åŒ…å«æ•æ„Ÿä¿¡æ¯ï¼ˆç§é’¥ã€API å¯†é’¥ç­‰ï¼‰ï¼Œåˆ‡å‹¿æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ
2. `.env.example` æ–‡ä»¶ä¸­çš„æ‰€æœ‰å€¼éƒ½æ˜¯**ç¤ºä¾‹å€¼**ï¼Œè¯·å‹¿ç›´æ¥ä½¿ç”¨
3. çœŸå®çš„ `.env` æ–‡ä»¶åº”ä¿å­˜åœ¨æœ¬åœ°ï¼Œä»…ä¾›å¼€å‘å›¢é˜Ÿå†…éƒ¨å…±äº«
4. åœ¨éƒ¨ç½²åˆ° Cloudflare Workers æ—¶ï¼Œè¯·é€šè¿‡ Cloudflare Dashboard é…ç½®ç¯å¢ƒå˜é‡

---

## ğŸ“ é…ç½®æ­¥éª¤

### 1. åˆ›å»º .env æ–‡ä»¶

åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œï¼š

```bash
cp .env.example .env
```

### 2. å¡«å†™çœŸå®å€¼

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼Œå°†æ‰€æœ‰å ä½ç¬¦æ›¿æ¢ä¸ºå®é™…å€¼ï¼š

#### åŒºå—é“¾ç½‘ç»œé…ç½®

```bash
# Polygon Amoy Testnet RPC URL
POLYGON_AMOY_RPC_URL=https://rpc-amoy.polygon.technology

# Chain ID
CHAIN_ID=80002
```

**è¯´æ˜**ï¼š
- ä½¿ç”¨å…¬å…± RPC URL æˆ–è‡ªå»º RPC èŠ‚ç‚¹
- Amoy Testnet Chain ID å›ºå®šä¸º 80002

---

#### é’±åŒ…åœ°å€é…ç½®

```bash
# åœ°å€ A - è¢«ä¿æŠ¤åœ°å€
PROTECTED_ADDRESS=0xçœŸå®åœ°å€A
PROTECTED_PRIVATE_KEY=0xçœŸå®ç§é’¥A

# åœ°å€ B - å®‰å…¨åœ°å€
SAFE_ADDRESS=0xçœŸå®åœ°å€B
SAFE_PRIVATE_KEY=0xçœŸå®ç§é’¥B

# åœ°å€ C - Gas è´¹åœ°å€
GAS_ADDRESS=0xçœŸå®åœ°å€C
GAS_PRIVATE_KEY=0xçœŸå®ç§é’¥C
```

**é‡è¦**ï¼š
- `PROTECTED_PRIVATE_KEY` å¯ä»¥åœ¨å‰ç«¯å…¬ç¤ºï¼ˆç”¨äºæµ‹è¯•ï¼‰
- `SAFE_PRIVATE_KEY` å’Œ `GAS_PRIVATE_KEY` å¿…é¡»**ä¿å¯†**ï¼Œä»…é…ç½®åˆ° Worker
- ç§é’¥æ ¼å¼ï¼š`0x` å¼€å¤´çš„ 64 ä½åå…­è¿›åˆ¶å­—ç¬¦ä¸²

---

#### ERC20 ä»£å¸åˆçº¦é…ç½®

```bash
TOKEN_CONTRACT_ADDRESS=0x35774A4E1fFEee74Fa3859F89cfae00b3aC8C3A8
TOKEN_DECIMALS=18
```

**è¯´æ˜**ï¼š
- åˆçº¦åœ°å€å·²åœ¨ Polygon Amoy Testnet éƒ¨ç½²å¹¶éªŒè¯
- ä»£å¸ç²¾åº¦ä¸º 18

---

#### Worker é…ç½®

```bash
EMERGENCY_MODE=false
SCAN_INTERVAL_NORMAL=60
SCAN_INTERVAL_EMERGENCY=5
BALANCE_THRESHOLD=0.01
MAX_RETRY_COUNT=3
RETRY_DELAY=2000
```

**è¯´æ˜**ï¼š
- `EMERGENCY_MODE`: åº”æ€¥çŠ¶æ€å¼€å…³ï¼ˆ`true`/`false`ï¼‰
- `SCAN_INTERVAL_NORMAL`: å¸¸è§„æ¨¡å¼æ‰«æé—´éš”ï¼ˆç§’ï¼‰
- `SCAN_INTERVAL_EMERGENCY`: åº”æ€¥æ¨¡å¼æ‰«æé—´éš”ï¼ˆç§’ï¼‰
- `BALANCE_THRESHOLD`: ä½™é¢é˜ˆå€¼ï¼Œä½äºæ­¤å€¼ä¸æ‰§è¡Œè½¬ç§»
- `MAX_RETRY_COUNT`: äº¤æ˜“å¤±è´¥æœ€å¤§é‡è¯•æ¬¡æ•°
- `RETRY_DELAY`: é‡è¯•é—´éš”ï¼ˆæ¯«ç§’ï¼‰

---

#### Cloudflare Workers é…ç½®

```bash
CLOUDFLARE_ACCOUNT_ID=your_account_id
CLOUDFLARE_API_TOKEN=your_api_token
WORKER_DOMAIN=your-worker-domain.workers.dev
```

**è·å–æ–¹å¼**ï¼š
1. ç™»å½• [Cloudflare Dashboard](https://dash.cloudflare.com/)
2. è¿›å…¥ Workers & Pages
3. æŸ¥çœ‹ Account IDï¼ˆåœ¨å³ä¾§è¾¹æ ï¼‰
4. åˆ›å»º API Tokenï¼ˆæƒé™ï¼šAccount > Cloudflare Workers > Editï¼‰

---

#### å‰ç«¯é…ç½®

```bash
APP_TITLE=X-plan Demo
NODE_ENV=development
CORS_ORIGIN=http://localhost:3000
```

**è¯´æ˜**ï¼š
- `NODE_ENV`: `development`ï¼ˆå¼€å‘ï¼‰æˆ– `production`ï¼ˆç”Ÿäº§ï¼‰
- `CORS_ORIGIN`: å…è®¸çš„å‰ç«¯æºåœ°å€

---

#### æ•°æ®åº“é…ç½®ï¼ˆå¯é€‰ï¼‰

å¦‚éœ€ä½¿ç”¨ Supabase å­˜å‚¨æ—¥å¿—å’Œæ•°æ®ï¼š

```bash
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_ANON_KEY=your_anon_key
SUPABASE_SERVICE_ROLE_KEY=your_service_role_key
```

---

## ğŸ” éƒ¨ç½²åˆ° Cloudflare Workers

Cloudflare Workers çš„ç¯å¢ƒå˜é‡éœ€è¦é€šè¿‡ Cloudflare Dashboard é…ç½®ï¼š

### æ–¹æ³• 1: é€šè¿‡ Dashboard é…ç½®

1. ç™»å½• Cloudflare Dashboard
2. è¿›å…¥ Workers & Pages
3. é€‰æ‹©ä½ çš„ Worker
4. ç‚¹å‡» Settings > Variables and Secrets
5. æ·»åŠ ä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼š

**å¿…éœ€å˜é‡**ï¼š
```
PROTECTED_ADDRESS
PROTECTED_PRIVATE_KEY
SAFE_ADDRESS
SAFE_PRIVATE_KEY
GAS_ADDRESS
GAS_PRIVATE_KEY
TOKEN_CONTRACT_ADDRESS
POLYGON_AMOY_RPC_URL
CHAIN_ID
EMERGENCY_MODE
SCAN_INTERVAL_NORMAL
SCAN_INTERVAL_EMERGENCY
BALANCE_THRESHOLD
```

### æ–¹æ³• 2: é€šè¿‡ Wrangler CLI é…ç½®

ä½¿ç”¨ `wrangler secret` å‘½ä»¤é…ç½®æ•æ„Ÿä¿¡æ¯ï¼š

```bash
# é…ç½®ç§é’¥ï¼ˆåŠ å¯†å­˜å‚¨ï¼‰
wrangler secret put PROTECTED_PRIVATE_KEY
wrangler secret put SAFE_PRIVATE_KEY
wrangler secret put GAS_PRIVATE_KEY
wrangler secret put CLOUDFLARE_API_TOKEN
wrangler secret put SUPABASE_SERVICE_ROLE_KEY

# é…ç½®æ™®é€šç¯å¢ƒå˜é‡
wrangler secret put POLYGON_AMOY_RPC_URL
wrangler secret put TOKEN_CONTRACT_ADDRESS
```

**æ³¨æ„**ï¼š
- ç§é’¥å’Œ API å¯†é’¥åº”ä½¿ç”¨ `secret put` å‘½ä»¤ï¼ˆåŠ å¯†å­˜å‚¨ï¼‰
- éæ•æ„Ÿé…ç½®å¯å†™åœ¨ `wrangler.toml` ä¸­

---

## ğŸ§ª æµ‹è¯•ç¯å¢ƒå˜é‡

### æœ¬åœ°å¼€å‘

åˆ›å»º `.env` æ–‡ä»¶åï¼Œé‡å¯å¼€å‘æœåŠ¡å™¨ï¼š

```bash
# Frontend
npm run dev

# Worker
npx wrangler dev
```

### éªŒè¯é…ç½®

åœ¨ä»£ç ä¸­æ·»åŠ æµ‹è¯•ï¼š

```javascript
// frontend/src/lib/config.js
console.log('RPC URL:', import.meta.env.VITE_POLYGON_AMOY_RPC_URL);
console.log('Token Contract:', import.meta.env.VITE_TOKEN_CONTRACT_ADDRESS);
```

---

## ğŸ“Š ç¯å¢ƒå˜é‡ä¼˜å…ˆçº§

1. **Cloudflare Workers Secrets**ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼ŒåŠ å¯†å­˜å‚¨ï¼‰
2. **Cloudflare Workers Environment Variables**
3. **æœ¬åœ° `.env` æ–‡ä»¶**
4. **ä»£ç ä¸­çš„é»˜è®¤å€¼**ï¼ˆæœ€ä½ä¼˜å…ˆçº§ï¼‰

---

## âš ï¸ å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆå‰ç«¯æ— æ³•è¯»å–ç¯å¢ƒå˜é‡ï¼Ÿ

**A**: å‰ç«¯æ¡†æ¶ï¼ˆViteï¼‰è¦æ±‚ç¯å¢ƒå˜é‡ä»¥ `VITE_` å¼€å¤´ã€‚ä¿®æ”¹ `.env`ï¼š

```bash
# å‰ç«¯å¯è¯»å–
VITE_TOKEN_CONTRACT_ADDRESS=0x35774A4E1fFEee74Fa3859F89cfae00b3aC8C3A8

# åç«¯å¯è¯»å–
TOKEN_CONTRACT_ADDRESS=0x35774A4E1fFEee74Fa3859F89cfae00b3aC8C3A8
```

### Q2: å¦‚ä½•ä¿æŠ¤ç§é’¥å®‰å…¨ï¼Ÿ

**A**ï¼š
1. ä½¿ç”¨ Cloudflare Workers Secretsï¼ˆåŠ å¯†å­˜å‚¨ï¼‰
2. ç»ä¸åœ¨å‰ç«¯ä»£ç ä¸­åŒ…å«æ•æ„Ÿç§é’¥
3. ç§é’¥ä»…é€šè¿‡ç¯å¢ƒå˜é‡ä¼ é€’
4. å®šæœŸè½®æ¢å¯†é’¥

### Q3: å¦‚ä½•åœ¨ä¸åŒç¯å¢ƒä½¿ç”¨ä¸åŒé…ç½®ï¼Ÿ

**A**: åˆ›å»ºå¤šä¸ªç¯å¢ƒæ–‡ä»¶ï¼š

```bash
# å¼€å‘ç¯å¢ƒ
.env.development

# æµ‹è¯•ç¯å¢ƒ
.env.test

# ç”Ÿäº§ç¯å¢ƒ
.env.production
```

ä½¿ç”¨æ—¶æŒ‡å®šç¯å¢ƒï¼š

```bash
NODE_ENV=production npm run build
```

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [Cloudflare Workers ç¯å¢ƒå˜é‡](https://developers.cloudflare.com/workers/configuration/environment-variables/)
- [Vite ç¯å¢ƒå˜é‡](https://vitejs.dev/guide/env-and-mode.html)
- [Polygon æ–‡æ¡£](https://docs.polygon.technology/)

---

æœ€åæ›´æ–°: 2026-02-07
