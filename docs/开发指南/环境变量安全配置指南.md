# ç¯å¢ƒå˜é‡å®‰å…¨é…ç½®æŒ‡å—

**åˆ›å»ºæ—¥æœŸ**: 2026-02-09  
**é€‚ç”¨é¡¹ç›®**: X-plan 2026

---

## ğŸ“‹ ç›®å½•ç»“æ„

```
xplan2026/
â”œâ”€â”€ .env.example                    # âœ… å¯æäº¤ - é¡¹ç›®æ ¹ç›®å½•æ¨¡æ¿
â”œâ”€â”€ .env                           # âŒ ä¸æäº¤ - æœ¬åœ°çœŸå®å€¼
â”œâ”€â”€ frontend/
â”‚   â””â”€â”€ official-site/
â”‚       â”œâ”€â”€ .env.example            # âœ… å¯æäº¤ - å‰ç«¯æ¨¡æ¿
â”‚       â””â”€â”€ .env                   # âŒ ä¸æäº¤ - å‰ç«¯æœ¬åœ°é…ç½®
â””â”€â”€ .gitignore                      # âœ… é…ç½®æ–‡ä»¶
```

---

## âœ… .gitignore é…ç½®

```gitignore
# Environment variables
# æ’é™¤æ‰€æœ‰çœŸå®çš„ .env æ–‡ä»¶
.env
.env.local
.env.development.local
.env.production.local
.env.test.local

# ä¿ç•™ .env.example æ¨¡æ¿æ–‡ä»¶
!.env.example
```

---

## ğŸ” æ•æ„Ÿæ•°æ®å­˜å‚¨ç­–ç•¥

### æ ¹ç›®å½•é…ç½®ï¼ˆ`.env.example` + `.env`ï¼‰

| é…ç½®é¡¹ | å­˜å‚¨ä½ç½® | è¯´æ˜ |
|--------|----------|------|
| åŒºå—é“¾ RPC URL | `.env.example` | âœ… å…¬å¼€é…ç½® |
| é’±åŒ…åœ°å€ | `.env.example` | âœ… å…¬å¼€é…ç½®ï¼ˆä»…åœ°å€ï¼‰ |
| **ç§é’¥** | âŒ ä¸è¦å­˜å‚¨åœ¨æ–‡ä»¶ä¸­ | âš ï¸ ä½¿ç”¨ Cloudflare Secrets |
| **Cloudflare API Token** | âŒ ä¸è¦å­˜å‚¨åœ¨æ–‡ä»¶ä¸­ | âš ï¸ ä½¿ç”¨ GitHub Secrets |
| **GitHub Token** | âŒ ä¸è¦å­˜å‚¨åœ¨æ–‡ä»¶ä¸­ | âš ï¸ ä½¿ç”¨ GitHub Secrets |
| Supabase Anon Key | `.env.example` | âœ… å…¬å¼€é…ç½® |
| **Supabase Service Role Key** | âŒ ä¸è¦å­˜å‚¨åœ¨æ–‡ä»¶ä¸­ | âš ï¸ ä½¿ç”¨ Cloudflare Secrets |

### å‰ç«¯é…ç½®ï¼ˆ`frontend/official-site/.env.example` + `.env`ï¼‰

| é…ç½®é¡¹ | å­˜å‚¨ä½ç½® | è¯´æ˜ |
|--------|----------|------|
| åŒºå—é“¾ RPC URL | `.env.example` | âœ… å…¬å¼€é…ç½® |
| API Base URL | `.env.example` | âœ… å…¬å¼€é…ç½® |
| Supabase URL | `.env` | âš ï¸ ä»…åœ¨æœ¬åœ°ä½¿ç”¨ |
| Supabase Anon Key | `.env` | âš ï¸ ä»…åœ¨æœ¬åœ°ä½¿ç”¨ |
| é’±åŒ…åœ°å€ | `.env.example` | âœ… å…¬å¼€é…ç½®ï¼ˆä»…åœ°å€ï¼‰ |
| **ç§é’¥** | âŒ æ°¸ä¸å­˜å‚¨ | âš ï¸ æµè§ˆå™¨ localStorage |

---

## ğŸ“¦ ä¸åŒç¯å¢ƒçš„å­˜å‚¨æ–¹æ¡ˆ

### 1. æœ¬åœ°å¼€å‘ç¯å¢ƒ

**æ ¹ç›®å½•**:
```bash
# åˆ›å»º .env
cp .env.example .env
# ç¼–è¾‘ .envï¼Œå¡«å†™æœ¬åœ°é…ç½®
```

**å‰ç«¯**:
```bash
cd frontend/official-site
cp .env.example .env
# ç¼–è¾‘ .envï¼Œå¡«å†™æœ¬åœ°é…ç½®
```

**ç§æœ‰æ•°æ®å­˜å‚¨æ–¹å¼**:
- ä½¿ç”¨æ“ä½œç³»ç»Ÿå¯†é’¥ç¯ï¼ˆæ¨èï¼‰
- æˆ–ä¸´æ—¶å­˜å‚¨åœ¨ `.env`ï¼ˆä»…æœ¬åœ°ï¼‰

---

### 2. GitHub Actions ç¯å¢ƒ

**å­˜å‚¨ä½ç½®**: GitHub Secrets

**é…ç½®æ­¥éª¤**:
1. è®¿é—® https://github.com/xplan2026/xplandemo/settings/secrets/actions
2. æ·»åŠ ä»¥ä¸‹ Secrets:
   ```
   CLOUDFLARE_API_TOKEN=<your-token>
   SUPABASE_SERVICE_KEY=<your-key>
   SSH_PRIVATE_KEY=<your-key>
   ```
3. åœ¨ workflow ä¸­ä½¿ç”¨:
   ```yaml
   env:
     CLOUDFLARE_API_TOKEN: ${{ secrets.CLOUDFLARE_API_TOKEN }}
   ```

---

### 3. Cloudflare Worker ç¯å¢ƒ

**å­˜å‚¨ä½ç½®**: Cloudflare Secrets

**é…ç½®æ­¥éª¤**:
```bash
cd cloudflare/worker-tactics-1

# è®¾ç½®ç§é’¥
npx wrangler secret put PROTECTED_PRIVATE_KEY
# æç¤ºæ—¶è¾“å…¥ç§é’¥å€¼

# è®¾ç½®æ•°æ®åº“å¯†é’¥
npx wrangler secret put SUPABASE_SERVICE_KEY

# è®¾ç½® API Key
npx wrangler secret put API_SECRET_KEY
```

**åœ¨ä»£ç ä¸­ä½¿ç”¨**:
```javascript
// Worker ä»£ç ä¸­
const PROTECTED_PRIVATE_KEY = PROTECTED_PRIVATE_KEY;
const SUPABASE_SERVICE_KEY = SUPABASE_SERVICE_KEY;
```

---

### 4. æœåŠ¡å™¨ç¯å¢ƒ

**å­˜å‚¨ä½ç½®**: systemd service æ–‡ä»¶æˆ– /etc/environment

**é…ç½®æ­¥éª¤**:
```bash
# ç¼–è¾‘ systemd service æ–‡ä»¶
sudo systemctl edit xplan-demo

# æ·»åŠ ç¯å¢ƒå˜é‡
[Service]
Environment="API_KEY=your-key"
Environment="SUPABASE_URL=https://xxx.supabase.co"
```

**æˆ–ä½¿ç”¨ /etc/environment**:
```bash
sudo nano /etc/environment

# æ·»åŠ 
API_KEY=your-key
SUPABASE_URL=https://xxx.supabase.co
```

---

## ğŸš« ç¦æ­¢äº‹é¡¹

### âŒ æ°¸ä¸æäº¤åˆ° Git çš„å†…å®¹

1. **æ‰€æœ‰ç§é’¥**ï¼ˆå³ä½¿åŠ å¯†ï¼‰
   ```
   0x<your-private-key-here>
   ```

2. **API Token**
   ```
   ghp_<your-github-token>
   lk55_<your-cloudflare-token>
   ```

3. **æ•°æ®åº“å¯†ç /å¯†é’¥**
   ```
   SUPABASE_SERVICE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
   ```

4. **SSH ç§é’¥**
   ```
   TERMINAL_LOGIN_COMMAND=ssh -i ~/.ssh/xplan_server_key ubuntu@182.254.180.26
   ```

### âœ… å¯ä»¥æäº¤åˆ° Git çš„å†…å®¹

1. **`.env.example`** - æ¨¡æ¿æ–‡ä»¶ï¼ˆä½¿ç”¨å ä½ç¬¦ï¼‰
2. **`.gitignore`** - é…ç½®æ–‡ä»¶
3. **å…¬å¼€é…ç½®** - RPC URLã€é’±åŒ…åœ°å€ï¼ˆä¸å«ç§é’¥ï¼‰

---

## ğŸ”’ å‰ç«¯ç§é’¥ç®¡ç†

### âŒ é”™è¯¯åšæ³•

```typescript
// ä¸è¦è¿™æ ·åšï¼
const privateKey = import.meta.env.VITE_PROTECTED_PRIVATE_KEY;
```

### âœ… æ­£ç¡®åšæ³•

```typescript
// åœ¨æµè§ˆå™¨ä¸­ç”Ÿæˆå¹¶å­˜å‚¨
const generateKeyPair = async () => {
  const keyPair = await window.crypto.subtle.generateKey(
    {
      name: "RSA-OAEP",
      modulusLength: 2048,
      publicExponent: new Uint8Array([1, 0, 1]),
      hash: "SHA-256"
    },
    true,
    ["encrypt", "decrypt"]
  );

  // å­˜å‚¨åˆ° localStorageï¼ˆä»…æœ¬åœ°ï¼‰
  const exportedKey = await window.crypto.subtle.exportKey("jwk", keyPair.privateKey);
  localStorage.setItem('privateKey', JSON.stringify(exportedKey));

  return keyPair;
};

// ä½¿ç”¨æ—¶ä» localStorage è¯»å–
const getPrivateKey = () => {
  const key = localStorage.getItem('privateKey');
  if (!key) return null;
  return JSON.parse(key);
};
```

---

## ğŸ“ é…ç½®æ¸…å•

### æœ¬åœ°å¼€å‘ç¯å¢ƒåˆå§‹åŒ–

```bash
# 1. åˆ›å»ºæœ¬åœ°é…ç½®æ–‡ä»¶
cp .env.example .env
cp frontend/official-site/.env.example frontend/official-site/.env

# 2. ç¼–è¾‘é…ç½®æ–‡ä»¶
nano .env
nano frontend/official-site/.env

# 3. å¡«å†™å¿…è¦é…ç½®
# - Supabase URL å’Œ Anon Key
# - æœ¬åœ° API åœ°å€

# 4. ç§é’¥é…ç½®ï¼ˆæ¨èä½¿ç”¨ Cloudflare Secretsï¼‰
npx wrangler secret put PROTECTED_PRIVATE_KEY

# 5. éªŒè¯é…ç½®
git status  # åº”è¯¥ä¸æ˜¾ç¤º .env æ–‡ä»¶ï¼ˆå·²è¢« .gitignore å¿½ç•¥ï¼‰
```

### GitHub Actions åˆå§‹åŒ–

```bash
# åœ¨ GitHub ç½‘é¡µæ“ä½œï¼š
# 1. Settings â†’ Secrets and variables â†’ Actions
# 2. New repository secret
# 3. æ·»åŠ å¿…è¦çš„ Secrets
```

**å¿…éœ€çš„ Secrets**:
- `CLOUDFLARE_API_TOKEN`
- `SSH_PRIVATE_KEY`
- `SUPABASE_SERVICE_KEY`ï¼ˆå¯é€‰ï¼‰

---

## ğŸ” å®‰å…¨æ£€æŸ¥

### æäº¤å‰æ£€æŸ¥

```bash
# æ£€æŸ¥æ˜¯å¦æœ‰æ•æ„Ÿä¿¡æ¯æäº¤
git diff --staged | grep -i "0x[0-9a-f]\{64\}"
git diff --staged | grep -i "ghp_"
git diff --staged | grep -i "lk55_"

# æ£€æŸ¥ .env æ–‡ä»¶æ˜¯å¦è¢«è¿½è¸ª
git ls-files | grep "^\.env"

# åº”è¯¥è¿”å›ç©º
```

### ä½¿ç”¨ pre-commit hook

é¡¹ç›®å·²é…ç½® pre-commit hookï¼ˆ`/.git/hooks/pre-commit`ï¼‰ï¼Œä¼šè‡ªåŠ¨æ£€æŸ¥ï¼š
- ç§é’¥æ ¼å¼
- API Token æ³„éœ²
- ç¯å¢ƒæ–‡ä»¶æäº¤
- å¤§æ–‡ä»¶è­¦å‘Š

**æµ‹è¯• hook**:
```bash
# å°è¯•æäº¤åŒ…å«ç§é’¥çš„æ–‡ä»¶
echo 'PRIVATE_KEY=0x1234...' > test.txt
git add test.txt
git commit -m "test"
# åº”è¯¥è¢«é˜»æ­¢
```

---

## ğŸ“š å‚è€ƒèµ„æº

- [Vite ç¯å¢ƒå˜é‡æ–‡æ¡£](https://vitejs.dev/guide/env-and-mode.html)
- [Cloudflare Secrets æ–‡æ¡£](https://developers.cloudflare.com/workers/configuration/secrets/)
- [GitHub Secrets æ–‡æ¡£](https://docs.github.com/en/actions/security-guides/encrypted-secrets)
- [Git å¿½ç•¥æœ€ä½³å®è·µ](https://git-scm.com/docs/gitignore)

---

**æœ€åæ›´æ–°**: 2026-02-09
